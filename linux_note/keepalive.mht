From: WizMime<support@wiz.cn>
Subject: =?gb2312?B?a2VlcGFsaXZl?=
Date: Date: Sat, 16 Apr 2016 09:28:22 +0800
MIME-Version: 1.0
Content-Type: multipart/related;
	type="multipart/alternative";
	boundary="----=_Next_Part_0012926850.827"

This is a multi-part message in MIME format.

------=_Next_Part_0012926850.827
Content-Type: multipart/alternative;
	boundary="----=_Next_Part_0004308950.961"


------=_Next_Part_0004308950.961
Content-Type: text/plain;
	charset="gb2312"
Content-Transfer-Encoding: quoted-printable

This is a multi-part message in MIME format.

------=_Next_Part_0004308950.961
Content-Type: text/html;
	charset="gb2312"
Content-Transfer-Encoding: quoted-printable

<!DOCTYPE html>=0A<html><head>=0D=0A<meta http-equiv=3D"Content-T=
ype" content=3D"text/html; charset=3Dgb2312"><meta http-equiv=3D"=
X-UA-Compatible" content=3D"IE=3D8" />=0A=0A<!--defaultCSS-->=0A<=
title>keepalive</title>=0A=0A=0A=0A=0A=0A<style type=3D"text/css"=
 id=3D"wiz_todo_style_id" wiz_link_version=3D"01.00.09">.wiz-todo=
, .wiz-todo-img {width: 16px; height: 16px; cursor: default; padd=
ing: 0 10px 0 2px; vertical-align: -10%;-webkit-user-select: none=
;} .wiz-todo-label { display: inline-block; padding-top: 7px; pad=
ding-bottom: 6px; line-height: 1.5;} .wiz-todo-label-checked {  c=
olor: #666;} .wiz-todo-label-unchecked {text-decoration: initial;=
} .wiz-todo-completed-info {padding-left: 44px; display: inline-b=
lock; } .wiz-todo-avatar { width:20px; height: 20px; vertical-ali=
gn: -20%; margin-right:10px; border-radius: 2px;} .wiz-todo-accou=
nt, .wiz-todo-dt { color: #666; }</style>=0A<style type=3D"text/c=
ss" id=3D"wiz_custom_css">=0Abody=0A{=0A    font-family: =CE=A2=C8=
=ED=D1=C5=BA=DA,"Microsoft YaHei", Georgia,Helvetica,Arial,sans-s=
erif,=CB=CE=CC=E5, PMingLiU,serif;=0A    font-size: 10.5pt;=0A  =20=
 line-height: 1.5;=0A}=0Ahtml, body=0A{=0A    =0A    =0A}=0Ah1 {=0A=
    font-size:1.5em;=0A    font-weight:bold;=0A}=0Ah2 {=0A    fon=
t-size:1.4em;=0A    font-weight:bold;=0A}=0Ah3 {=0A    font-size:=
1.3em;=0A    font-weight:bold;=0A}=0Ah4 {=0A    font-size:1.2em;=0A=
    font-weight:bold;=0A}=0Ah5 {=0A    font-size:1.1em;=0A    fon=
t-weight:bold;=0A}=0Ah6 {=0A    font-size:1.0em;=0A    font-weigh=
t:bold;=0A}=0Aimg {=0A    border:0;=0A    max-width: 100%;=0A   =20=
height: auto !important;=0A}=0Ablockquote {=0A    margin-top:0px;=
=0A    margin-bottom:0px;=0A}=0Atable {=0A    border-collapse:col=
lapse;=0A    border:1px solid #bbbbbb;=0A}=0Atd {=0A    border-co=
llapse:collapse;=0A    border:1px solid #bbbbbb;=0A}=0A</style>=0A=
</head>=0A=0A<body  style=3D""><div><br></div><div><br></div><div=
>www.keepalived.org</div><div><br></div><div><br></div><div><br><=
/div><div>LAN=BF=CD=BB=A7=B6=CB=C5=D0=B6=A8=C4=C4=B8=F6=C2=B7=D3=C9=
=C6=F7=D3=A6=B8=C3=CE=AA=C6=E4=B5=BD=B4=EF=C4=BF=B1=EA=D6=F7=BB=FA=
=B5=C4=CF=C2=D2=BB=CC=F8=CD=F8=B9=D8=B5=C4=B7=BD=CA=BD=D3=D0=B6=AF=
=CC=AC=BC=B0=BE=B2=CC=AC=BE=F6=B2=DF=C1=BD=D6=D6=B7=BD=CA=BD=A3=AC=
=C6=E4=D6=D0=A3=AC=B3=A3=BC=FB=B5=C4=B6=AF=CC=AC=C2=B7=D3=C9=B7=A2=
=CF=D6=B7=BD=CA=BD=D3=D0=C8=E7=CF=C2=BC=B8=D6=D6=A3=BA</div><div>=
1=A1=A2Proxy ARP =A1=AA=A1=AA =BF=CD=BB=A7=B6=CB=CA=B9=D3=C3ARP=D0=
=AD=D2=E9=BB=F1=C8=A1=C6=E4=CF=EB=D2=AA=B5=BD=B4=EF=B5=C4=C4=BF=B1=
=EA=A3=AC=B6=F8=BA=F3=A3=AC=D3=C9=C4=B3=C2=B7=D3=C9=D2=D4=C6=E4MA=
C=B5=D8=D6=B7=CF=EC=D3=A6=B4=CBARP=C7=EB=C7=F3=A3=BB</div><div>2=A1=
=A2Routing Protocol =A1=AA=A1=AA =BF=CD=BB=A7=B6=CB=BC=E0=CC=FD=B6=
=AF=CC=AC=C2=B7=D3=C9=B8=FC=D0=C2(=C8=E7=CD=A8=B9=FDRIP=BB=F2OSPF=
=D0=AD=D2=E9)=B2=A2=D2=D4=D6=AE=D6=D8=BD=A8=D7=D4=BC=BA=B5=C4=C2=B7=
=D3=C9=B1=ED=A3=BB</div><div>3=A1=A2ICMP IRDP (Router Discovery P=
rotocol) =BF=CD=BB=A7=B6=CB =A1=AA=A1=AA =BF=CD=BB=A7=B6=CB=D6=F7=
=BB=FA=D4=CB=D0=D0=D2=BB=B8=F6ICMP=C2=B7=D3=C9=B7=A2=CF=D6=BF=CD=BB=
=A7=B6=CB=B3=CC=D0=F2=A3=BB</div><div><br></div><div>=B6=AF=CC=AC=
=C2=B7=D3=C9=B7=A2=CF=D6=D0=AD=D2=E9=B5=C4=B2=BB=D7=E3=D6=AE=B4=A6=
=D4=DA=D3=DA=CB=FC=BB=E1=B5=BC=D6=C2=D4=DA=BF=CD=BB=A7=B6=CB=D2=FD=
=C6=F0=D2=BB=B6=A8=B5=C4=C5=E4=D6=C3=BA=CD=B4=A6=C0=ED=B7=BD=C3=E6=
=B5=C4=BF=AA=CF=FA=A3=AC=B2=A2=C7=D2=A3=AC=C8=E7=B9=FB=C2=B7=D3=C9=
=C6=F7=B9=CA=D5=CF=A3=AC=C7=D0=BB=BB=D6=C1=C6=E4=CB=FC=C2=B7=D3=C9=
=C6=F7=B5=C4=B9=FD=B3=CC=BB=E1=B1=C8=BD=CF=C2=FD=A1=A3=BD=E2=BE=F6=
=B4=CB=C0=E0=CE=CA=CC=E2=B5=C4=D2=BB=B8=F6=B7=BD=B0=B8=CA=C7=CE=AA=
=BF=CD=BB=A7=B6=CB=BE=B2=CC=AC=C5=E4=D6=C3=C4=AC=C8=CF=C2=B7=D3=C9=
=C9=E8=B1=B8=A3=AC=D5=E2=B4=F3=B4=F3=BC=F2=BB=AF=C1=CB=BF=CD=BB=A7=
=B6=CB=B5=C4=B4=A6=C0=ED=B9=FD=B3=CC=A3=AC=B5=AB=D2=B2=BB=E1=B4=F8=
=C0=B4=B5=A5=B5=E3=B9=CA=D5=CF=C0=E0=B5=C4=CE=CA=CC=E2=A1=A3=C4=AC=
=C8=CF=CD=F8=B9=D8=B9=CA=D5=CF=CA=B1=A3=ACLAN=BF=CD=BB=A7=B6=CB=BD=
=F6=C4=DC=CA=B5=CF=D6=B1=BE=B5=D8=CD=A8=D0=C5=A1=A3</div><div><br=
></div><div>VRRP=BF=C9=D2=D4=CD=A8=B9=FD=D4=DA=D2=BB=D7=E9=C2=B7=D3=
=C9=C6=F7(=D2=BB=B8=F6VRRP=D7=E9)=D6=AE=BC=E4=B9=B2=CF=ED=D2=BB=B8=
=F6=D0=E9=C4=E2IP(VIP)=BD=E2=BE=F6=BE=B2=CC=AC=C5=E4=D6=C3=B5=C4=CE=
=CA=CC=E2=A3=AC=B4=CB=CA=B1=BD=F6=D0=E8=D2=AA=BF=CD=BB=A7=B6=CB=D2=
=D4VIP=D7=F7=CE=AA=C6=E4=C4=AC=C8=CF=CD=F8=B9=D8=BC=B4=BF=C9=A1=A3=
</div><div><br></div><div>=CD=BC1=CF=D4=CA=BE=C1=CB=D2=BB=B8=F6=BB=
=F9=B1=BE=B5=C4VLAN=CD=D8=C6=CB=A3=AC=C6=E4=D6=D0=A3=ACRouter A=A1=
=A2B=A1=A2C=B9=B2=CD=AC=D7=E9=B3=C9=D2=BB=B8=F6VRRP=D7=E9=A3=AC=C6=
=E4VIP=CE=AA10.0.0.1=A3=AC=C5=E4=D6=C3=D4=DA=C2=B7=D3=C9=C6=F7A=B5=
=C4=CE=EF=C0=ED=BD=D3=BF=DA=C9=CF=A3=AC=D2=F2=B4=CBA=CE=AAmaster=C2=
=B7=D3=C9=C6=F7=A3=ACB=BA=CDC=CE=AAbackup=C2=B7=D3=C9=C6=F7=A1=A3=
VRRP=D7=E9=D6=D0=A3=ACmaster(=C2=B7=D3=C9=C6=F7A)=B8=BA=D4=F0=B8=BA=
=D4=F0=D7=AA=B7=A2=B7=A2=CD=F9VIP=B5=D8=D6=B7=B5=C4=B1=A8=CE=C4=A3=
=AC=BF=CD=BB=A7=B6=CB1=A1=A22=A1=A23=B6=BC=D2=D4=B4=CBVIP=D7=F7=CE=
=AA=C6=E4=C4=AC=C8=CF=CD=F8=B9=D8=A1=A3=D2=BB=B5=A9master=B9=CA=D5=
=CF=A3=ACbackup=C2=B7=D3=C9=C6=F7B=BA=CDC=D6=D0=BE=DF=D3=D0=D7=EE=
=B8=DF=D3=C5=CF=C8=BC=B6=B5=C4=C2=B7=D3=C9=C6=F7=BD=AB=B3=C9=CE=AA=
master=B2=A2=BD=D3=B9=DCVIP=B5=D8=D6=B7=A3=AC=B6=F8=B5=B1=D4=AD=C0=
=B4=B5=C4master=C2=B7=D3=C9=C6=F7A=D6=D8=D0=C2=C9=CF=CF=DF=CA=B1=A3=
=AC=C6=E4=BD=AB=D6=D8=D0=C2=B3=C9=CE=AAmaster=C2=B7=D3=C9=C6=F7=A1=
=A3</div><div>keepalived:=C6=F4=B6=AF=CA=B1,=CB=F9=D3=D0=BD=DA=B5=
=E3=B6=BC=CA=C7backup=D7=B4=CC=AC,=CD=A8=B9=FD=B6=A8=D2=E5=D3=C5=CF=
=C8=BC=B6=BD=F8=D0=D0=D7=EE=B3=F5=B5=C4=D1=A1=BE=D9(=B1=C8=C8=E7=D2=
=BB=B8=F6100.=D2=BB=B8=F699),=D3=C5=CF=C8=BC=B6=B8=DF=D1=A1=CE=AA=
=D6=F7=BD=DA=B5=E3,=B5=B1=B7=A2=CF=D6=D6=F7=BD=DA=B5=E3=B9=CA=D5=CF=
,=CD=A8=B9=FD=B6=D4=D3=C5=CF=C8=BC=B6=BD=B5=BC=B6(100-2),=C6=F4=B6=
=AF=B1=B8=D3=C3=BD=DA=B5=E3.</div><div><span class=3D"Apple-tab-s=
pan" style=3D"white-space:pre">	</span>VRRP:=BB=F9=D3=DAvrrp=D0=AD=
=D2=E9,=D0=E9=C4=E2=C8=DF=D3=E0=C2=B7=D3=C9=D0=AD=D2=E9.=CA=B5=CF=
=D6=CA=C7=D2=BB=B8=F6=A1=B0=D1=A1=BE=D9=A1=B1=D0=AD=D2=E9=A3=AC=CB=
=FC=C4=DC=B9=BB=B6=AF=CC=AC=B5=D8=BD=AB=D2=BB=B8=F6=D0=E9=C4=E2=C2=
=B7=D3=C9=C6=F7(=CD=AC=CA=B1=D0=E9=C4=E2VIP=BA=CD=D0=E9=C4=E2VMAC=
)=B5=C4=D4=F0=C8=CE=D6=B8=B6=A8=D6=C1=CD=AC=D2=BB=B8=F6VRRP=D7=E9=
=D6=D0=B5=C4=C6=E4=CB=FC=C2=B7=D3=C9=C6=F7=C9=CF=A3=AC=B4=D3=B6=F8=
=CF=FB=B3=FD=C1=CB=BE=B2=CC=AC=C2=B7=D3=C9=C5=E4=D6=C3=B5=C4=B5=A5=
=B5=E3=B9=CA=D5=CF=A1=A3</div><div>keepalive=B6=E0=D6=F7=C4=A3=D0=
=CD:=B8=F9=BE=DD=CE=EF=C0=ED=BD=DA=B5=E3=C9=E8=D6=C3=D0=E9=C4=E2=C2=
=B7=D3=C9=D7=E9,=C3=BF=B8=F6=BD=DA=B5=E3=B5=A3=C8=CE=D2=BB=D7=E9=D0=
=E9=C4=E2=C2=B7=D3=C9=D6=F7=BD=DA=B5=E3,,=CD=A8=B9=FDDNS=B5=C4A=BC=
=C7=C2=BC=B7=D6=CC=AF=B8=BA=D4=D8,=D2=D4=B4=EF=B5=BD=BB=A5=CE=AA=D6=
=F7=B1=B8,=B3=A3=D3=C3=D3=DA=B8=BA=D4=D8=BE=F9=BA=E2(nginx,haprox=
y,LVS)=B5=C4=B8=DF=BF=C9=D3=C3=B7=BD=B0=B8</div><div><br></div><d=
iv><br></div><div>VRRP=CA=F5=D3=EF=A3=BA</div><div>VRRP=D0=E9=C4=E2=
=C2=B7=D3=C9(VRRP router)=A3=BA</div><div><br></div><div><br></di=
v><div><br></div><div>VRRP=B5=C4=D3=C5=CA=C6=A3=BA</div><div><br>=
</div><div>=C8=DF=D3=E0=A3=BA=BF=C9=D2=D4=CA=B9=D3=C3=B6=E0=B8=F6=
=C2=B7=D3=C9=C6=F7=C9=E8=B1=B8=D7=F7=CE=AALAN=BF=CD=BB=A7=B6=CB=B5=
=C4=C4=AC=C8=CF=CD=F8=B9=D8=A3=AC=B4=F3=B4=F3=BD=B5=B5=CD=C1=CB=C4=
=AC=C8=CF=CD=F8=B9=D8=B3=C9=CE=AA=B5=A5=B5=E3=B9=CA=D5=CF=B5=C4=BF=
=C9=C4=DC=D0=D4=A3=BB</div><div>=B8=BA=D4=D8=B9=B2=CF=ED=A3=BA=D4=
=CA=D0=ED=C0=B4=D7=D4LAN=BF=CD=BB=A7=B6=CB=B5=C4=C1=F7=C1=BF=D3=C9=
=B6=E0=B8=F6=C2=B7=D3=C9=C6=F7=C9=E8=B1=B8=CB=F9=B9=B2=CF=ED=A3=BB=
</div><div>=B6=E0VRRP=D7=E9=A3=BA=D4=DA=D2=BB=B8=F6=C2=B7=D3=C9=C6=
=F7=CE=EF=C0=ED=BD=D3=BF=DA=C9=CF=BF=C9=C5=E4=D6=C3=B6=E0=B4=EF25=
5=B8=F6VRRP=D7=E9=A3=BB</div><div>=B6=E0IP=B5=D8=D6=B7=A3=BA=BB=F9=
=D3=DA=BD=D3=BF=DA=B1=F0=C3=FB=D4=DA=CD=AC=D2=BB=B8=F6=CE=EF=C0=ED=
=BD=D3=BF=DA=C9=CF=C5=E4=D6=C3=B6=E0=B8=F6IP=B5=D8=D6=B7=A3=AC=B4=
=D3=B6=F8=D6=A7=B3=D6=D4=DA=CD=AC=D2=BB=B8=F6=CE=EF=C0=ED=BD=D3=BF=
=DA=C9=CF=BD=D3=C8=EB=B6=E0=B8=F6=D7=D3=CD=F8=A3=BB</div><div>=C7=
=C0=D5=BC=A3=BA=D4=DAmaster=B9=CA=D5=CF=CA=B1=D4=CA=D0=ED=D3=C5=CF=
=C8=BC=B6=B8=FC=B8=DF=B5=C4backup=B3=C9=CE=AAmaster=A3=BB</div><d=
iv>=CD=A8=B8=E6=D0=AD=D2=E9=A3=BA=CA=B9=D3=C3IANA=CB=F9=D6=B8=B6=A8=
=B5=C4=D7=E9=B2=A5=B5=D8=D6=B7224.0.0.18=BD=F8=D0=D0VRRP=CD=A8=B8=
=E6=A3=BB</div><div>VRRP=D7=B7=D7=D9=A3=BA=BB=F9=D3=DA=BD=D3=BF=DA=
=D7=B4=CC=AC=C0=B4=B8=C4=B1=E4=C6=E4VRRP=D3=C5=CF=C8=BC=B6=C0=B4=C8=
=B7=B6=A8=D7=EE=BC=D1=B5=C4VRRP=C2=B7=D3=C9=C6=F7=B3=C9=CE=AAmast=
er=A3=BB</div><div><br></div><div><br></div><div><span class=3D"A=
pple-tab-span" style=3D"white-space:pre">	</span></div><div><br><=
/div><div>IP=B5=D8=D6=B7=D3=B5=D3=D0=D5=DF=A3=A8IP Address Owner=A3=
=A9=A3=BA=C8=E7=B9=FB=D2=BB=B8=F6VRRP=C9=E8=B1=B8=BD=AB=D0=E9=C4=E2=
=C2=B7=D3=C9=C6=F7IP=B5=D8=D6=B7=D7=F7=CE=AA=D5=E6=CA=B5=B5=C4=BD=
=D3=BF=DA=B5=D8=D6=B7=A3=AC=D4=F2=B8=C3=C9=E8=B1=B8=B1=BB=B3=C6=CE=
=AAIP=B5=D8=D6=B7=D3=B5=D3=D0=D5=DF=A1=A3=C8=E7=B9=FBIP=B5=D8=D6=B7=
=D3=B5=D3=D0=D5=DF=CA=C7=BF=C9=D3=C3=B5=C4=A3=AC=CD=A8=B3=A3=CB=FC=
=BD=AB=B3=C9=CE=AAMaster=A1=A3&nbsp;</div><div><br></div><div><sp=
an class=3D"Apple-tab-span" style=3D"white-space:pre">		</span>=C5=
=E4=D6=C3:man keepalived.conf</div><div><span class=3D"Apple-tab-=
span" style=3D"white-space:pre">		</span>global_defs {} &nbsp;#=C8=
=AB=BE=D6=C5=E4=D6=C3</div><div><span class=3D"Apple-tab-span" st=
yle=3D"white-space:pre">			</span>notification_email{} &nbsp;#=CA=
=D5=BC=FE=C8=CB</div><div><span class=3D"Apple-tab-span" style=3D=
"white-space:pre">			</span>notification_email_from {} #=B7=A2=BC=
=FE=C8=CB</div><div><span class=3D"Apple-tab-span" style=3D"white=
-space:pre">				</span>smtp_server &nbsp;&nbsp;</div><div><span c=
lass=3D"Apple-tab-span" style=3D"white-space:pre">				</span>smtp=
_connect_timeout</div><div><span class=3D"Apple-tab-span" style=3D=
"white-space:pre">				</span>router_id&nbsp;</div><div><span clas=
s=3D"Apple-tab-span" style=3D"white-space:pre">		</span>static ro=
utes &nbsp;=BE=B2=CC=AC=C2=B7=D3=C9</div><div><span class=3D"Appl=
e-tab-span" style=3D"white-space:pre">		</span>vrrp_script NAME {=
 } &nbsp;#=D7=D4=B6=A8=D2=E5=BD=C5=B1=BE=BF=C9=D2=D4=CA=C7shell=BD=
=C5=B1=BE=C2=B7=BE=B6=BB=F2=C3=FC=C1=EE</div><div><span class=3D"=
Apple-tab-span" style=3D"white-space:pre">			</span>script "scrip=
t" &nbsp; &nbsp;#=BD=C5=B1=BE=C2=B7=BE=B6=BB=F2=C3=FC=C1=EE</div>=
<div><span class=3D"Apple-tab-span" style=3D"white-space:pre">		=09=
</span>interval 1 &nbsp; #=BC=EC=B2=E9=CA=B1=BC=E4=BC=E4=B8=F4</d=
iv><div><span class=3D"Apple-tab-span" style=3D"white-space:pre">=
			</span>weight -2<span class=3D"Apple-tab-span" style=3D"white-=
space:pre">	</span> #=D3=C5=CF=C8=BC=B6-2,=B6=D4priority=B2=D9=D7=
=F7</div><div><span class=3D"Apple-tab-span" style=3D"white-space=
:pre">		</span>vrrp_instance NAME{} &nbsp;<span class=3D"Apple-ta=
b-span" style=3D"white-space:pre">	</span> &nbsp; #=D0=E9=C4=E2=C2=
=B7=D3=C9</div><div><span class=3D"Apple-tab-span" style=3D"white=
-space:pre">			</span>state &nbsp; &nbsp; &nbsp;#=BD=DA=B5=E3=CE=AA=
MASTER=BB=B9=CA=C7BACKUP,=C8=E7=B9=FB=C9=E8=D6=C3=CE=AAmaster,=D2=
=BB=B6=A8=D2=AA=D4=DA=CD=AC=D2=BB=D0=E9=C4=E2=C2=B7=D3=C9=D7=E9=BD=
=DA=B5=E3=D6=D0=B5=C4=D3=C5=CF=C8=BC=B6=D7=EE=B8=DF,=B1=D8=D0=EB=B4=
=F3=D0=B4</div><div><span class=3D"Apple-tab-span" style=3D"white=
-space:pre">			</span>interface eth0 &nbsp; &nbsp;#=C9=E8=B1=B8=C3=
=FB</div><div><span class=3D"Apple-tab-span" style=3D"white-space=
:pre">			</span>virtual_router_id 51 &nbsp;#=D0=E9=C4=E2=C2=B7=D3=
=C9=D7=E9=B5=C4ID</div><div><span class=3D"Apple-tab-span" style=3D=
"white-space:pre">			</span>priority 100 &nbsp;#=D3=C5=CF=C8=BC=B6=
=B3=F5=CA=BC=D6=B5</div><div><span class=3D"Apple-tab-span" style=
=3D"white-space:pre">			</span>advert_int 1 #=CD=A8=B8=E6=BC=B8=B8=
=F6</div><div><span class=3D"Apple-tab-span" style=3D"white-space=
:pre">			</span>authentication{} &nbsp;#=C8=CF=D6=A4=B7=BD=CA=BD=20=
=D3=D0=C8=FD=D6=D6=C8=CF=D6=A4,=C3=F7=CE=C4=BA=CDssl,=B2=BB=C8=CF=
=D6=A4</div><div><span class=3D"Apple-tab-span" style=3D"white-sp=
ace:pre">				</span>auth_pass PASS</div><div><span class=3D"Apple=
-tab-span" style=3D"white-space:pre">				</span>auth_pass 1111</d=
iv><div><span class=3D"Apple-tab-span" style=3D"white-space:pre">=
			</span>virtual_ipaddress{} VIP=B5=D8=D6=B7</div><div><span cla=
ss=3D"Apple-tab-span" style=3D"white-space:pre">				</span>&lt;ip=
addr&gt;/&lt;mask&gt; &nbsp;#ip</div><div><span class=3D"Apple-ta=
b-span" style=3D"white-space:pre">				</span>brd &lt;ipaddr&gt;<s=
pan class=3D"Apple-tab-span" style=3D"white-space:pre">	</span>#=B9=
=E3=B2=A5=B5=D8=D6=B7</div><div><span class=3D"Apple-tab-span" st=
yle=3D"white-space:pre">				</span>dev&lt;string&gt; &nbsp; #=C9=E8=
=B1=B8=C3=FB</div><div><span class=3D"Apple-tab-span" style=3D"wh=
ite-space:pre">				</span>label&lt;label&gt; &nbsp;#=CD=F8=BF=A8=B1=
=F0=C3=FB</div><div><span class=3D"Apple-tab-span" style=3D"white=
-space:pre">			</span>track_script {} &nbsp; #=D2=FD=C8=EB=BD=C5=B1=
=BE,=B2=A2=D7=B7=D7=D9=C5=D0=B6=CF</div><div><br></div><div>=C5=E4=
=D6=C3keepalived=CE=AA=CA=B5=CF=D6haproxy=B8=DF=BF=C9=D3=C3=B5=C4=
=C5=E4=D6=C3=CE=C4=BC=FE=CA=BE=C0=FD=A3=BA</div><div>############=
###########</div><div><span class=3D"Apple-tab-span" style=3D"whi=
te-space:pre">		</span>! Configuration File for keepalived &nbsp;=
</div><div><span class=3D"Apple-tab-span" style=3D"white-space:pr=
e">		</span> &nbsp;</div><div><span class=3D"Apple-tab-span" styl=
e=3D"white-space:pre">		</span>global_defs { &nbsp; &nbsp;</div><=
div><span class=3D"Apple-tab-span" style=3D"white-space:pre">		</=
span> &nbsp; notification_email { &nbsp;</div><div><span class=3D=
"Apple-tab-span" style=3D"white-space:pre">				</span> linuxedu@f=
oxmail.com</div><div><span class=3D"Apple-tab-span" style=3D"whit=
e-space:pre">				</span> mageedu@126.com &nbsp;</div><div><span c=
lass=3D"Apple-tab-span" style=3D"white-space:pre">		</span> &nbsp=
; } &nbsp;</div><div><span class=3D"Apple-tab-span" style=3D"whit=
e-space:pre">		</span> &nbsp; notification_email_from kanotify@ma=
gedu.com&nbsp;</div><div><span class=3D"Apple-tab-span" style=3D"=
white-space:pre">		</span> &nbsp; smtp_connect_timeout 30 &nbsp;<=
/div><div><span class=3D"Apple-tab-span" style=3D"white-space:pre=
">		</span> &nbsp; smtp_server 127.0.0.1 &nbsp;</div><div><span c=
lass=3D"Apple-tab-span" style=3D"white-space:pre">		</span> &nbsp=
; router_id LVS_DEVEL &nbsp;</div><div><span class=3D"Apple-tab-s=
pan" style=3D"white-space:pre">		</span>} &nbsp;</div><div><br></=
div><div><span class=3D"Apple-tab-span" style=3D"white-space:pre"=
>		</span>vrrp_script chk_haproxy { &nbsp;</div><div><span class=3D=
"Apple-tab-span" style=3D"white-space:pre">			</span>script "kill=
all -0 haproxy" &nbsp;</div><div><span class=3D"Apple-tab-span" s=
tyle=3D"white-space:pre">			</span>interval 1 &nbsp;</div><div><s=
pan class=3D"Apple-tab-span" style=3D"white-space:pre">			</span>=
weight 2 &nbsp;</div><div><span class=3D"Apple-tab-span" style=3D=
"white-space:pre">		</span>} &nbsp;</div><div><br></div><div><spa=
n class=3D"Apple-tab-span" style=3D"white-space:pre">		</span>vrr=
p_script chk_mantaince_down {</div><div><span class=3D"Apple-tab-=
span" style=3D"white-space:pre">		</span> &nbsp; script "[[ -f /e=
tc/keepalived/down ]] &amp;&amp; exit 1 || exit 0"</div><div><spa=
n class=3D"Apple-tab-span" style=3D"white-space:pre">		</span> &n=
bsp; interval 1</div><div><span class=3D"Apple-tab-span" style=3D=
"white-space:pre">		</span> &nbsp; weight -2</div><div><span clas=
s=3D"Apple-tab-span" style=3D"white-space:pre">		</span>}</div><d=
iv><br></div><div><span class=3D"Apple-tab-span" style=3D"white-s=
pace:pre">		</span>vrrp_instance VI_1 { &nbsp;</div><div><span cl=
ass=3D"Apple-tab-span" style=3D"white-space:pre">			</span>interf=
ace eth0 &nbsp;</div><div><span class=3D"Apple-tab-span" style=3D=
"white-space:pre">			</span>state MASTER &nbsp;# BACKUP for slave=
 routers</div><div><span class=3D"Apple-tab-span" style=3D"white-=
space:pre">			</span>priority 101 &nbsp;# 100 for BACKUP</div><di=
v><span class=3D"Apple-tab-span" style=3D"white-space:pre">			</s=
pan>virtual_router_id 51&nbsp;</div><div><span class=3D"Apple-tab=
-span" style=3D"white-space:pre">			</span>garp_master_delay 1&nb=
sp;</div><div><span class=3D"Apple-tab-span" style=3D"white-space=
:pre">		</span> &nbsp;</div><div><span class=3D"Apple-tab-span" s=
tyle=3D"white-space:pre">			</span>authentication { &nbsp;</div><=
div><span class=3D"Apple-tab-span" style=3D"white-space:pre">			=09=
</span>auth_type PASS &nbsp;</div><div><span class=3D"Apple-tab-s=
pan" style=3D"white-space:pre">				</span>auth_pass password &nbs=
p;</div><div><span class=3D"Apple-tab-span" style=3D"white-space:=
pre">			</span>} &nbsp;</div><div><span class=3D"Apple-tab-span"=20=
style=3D"white-space:pre">			</span>track_interface { &nbsp;</div=
><div><span class=3D"Apple-tab-span" style=3D"white-space:pre">	=09=
	</span> &nbsp; eth0 &nbsp; &nbsp;</div><div><span class=3D"Apple=
-tab-span" style=3D"white-space:pre">			</span>} &nbsp;</div><div=
><span class=3D"Apple-tab-span" style=3D"white-space:pre">			</sp=
an>virtual_ipaddress { &nbsp;</div><div><span class=3D"Apple-tab-=
span" style=3D"white-space:pre">				</span>172.16.100.1/16 dev et=
h0 label eth0:0&nbsp;</div><div><span class=3D"Apple-tab-span" st=
yle=3D"white-space:pre">			</span>} &nbsp;</div><div><span class=3D=
"Apple-tab-span" style=3D"white-space:pre">			</span>track_script=
 { &nbsp;</div><div><span class=3D"Apple-tab-span" style=3D"white=
-space:pre">				</span>chk_haproxy &nbsp;</div><div><span class=3D=
"Apple-tab-span" style=3D"white-space:pre">				</span>chk_mantain=
ce_down</div><div><span class=3D"Apple-tab-span" style=3D"white-s=
pace:pre">			</span>} &nbsp;</div><div><span class=3D"Apple-tab-s=
pan" style=3D"white-space:pre">		</span> &nbsp;</div><div><span c=
lass=3D"Apple-tab-span" style=3D"white-space:pre">		</span>&nbsp;=
</div><div><span class=3D"Apple-tab-span" style=3D"white-space:pr=
e">			</span>notify_master "/etc/keepalived/notify.sh master" &nb=
sp;</div><div><span class=3D"Apple-tab-span" style=3D"white-space=
:pre">			</span>notify_backup "/etc/keepalived/notify.sh backup"=20=
&nbsp;</div><div><span class=3D"Apple-tab-span" style=3D"white-sp=
ace:pre">			</span>notify_fault "/etc/keepalived/notify.sh fault"=
 &nbsp;</div><div><span class=3D"Apple-tab-span" style=3D"white-s=
pace:pre">		</span>}&nbsp;</div><div><br></div><div><br></div><di=
v>=D7=A2=D2=E2=A3=BA</div><div>1=A1=A2=C9=CF=C3=E6=B5=C4state=CE=AA=
=B5=B1=C7=B0=BD=DA=B5=E3=B5=C4=C6=F0=CA=BC=D7=B4=CC=AC=A3=AC=CD=A8=
=B3=A3=D4=DAmaster/slave=B5=C4=CB=AB=BD=DA=B5=E3=C4=A3=D0=CD=D6=D0=
=A3=AC=C6=E4=D2=BB=B8=F6=C4=AC=C8=CF=CE=AAMASTER=A3=AC=B6=F8=B1=F0=
=D2=BB=B8=F6=C4=AC=C8=CF=CE=AABACKUP=A1=A3</div><div>2=A1=A2prior=
ity=CE=AA=B5=B1=B9=D8=BD=DA=B5=E3=D4=DA=B5=B1=C7=B0=D0=E9=C4=E2=C2=
=B7=D3=C9=C6=F7=D6=D0=B5=C4=D3=C5=CF=C8=BC=B6=A3=ACmaster=B5=C4=D3=
=C5=CF=C8=BC=B6=D3=A6=B8=C3=B4=F3=D3=DAslave=B5=C4=A3=BB</div><di=
v><br></div><div><br></div><div>=D7=B4=CC=AC=D7=AA=BB=BB=CD=A8=D6=
=AA:=D4=DAvrrp_instance NAME{}=D6=D0=D2=FD=D3=C3=BD=C5=B1=BE</div=
><div><span class=3D"Apple-tab-span" style=3D"white-space:pre">	=09=
</span>1)=B7=D6=B1=F0=D0=B43=B8=F6=BD=C5=B1=BE</div><div><span cl=
ass=3D"Apple-tab-span" style=3D"white-space:pre">		</span>notify_=
maser /path/to_master.sh &nbsp; #=D7=AA=BB=BBmaster=D3=C3=C4=C7=B8=
=F6=BD=C5=B1=BE,=BD=C5=B1=BE=C8=E7=B9=FB=B4=F8=B2=CE=CA=FD,=D2=AA=
=D3=C3""=C0=A8=C6=F0=C0=B4</div><div><span class=3D"Apple-tab-spa=
n" style=3D"white-space:pre">		</span>notify_backup /path/to_back=
up.sh</div><div><span class=3D"Apple-tab-span" style=3D"white-spa=
ce:pre">		</span>notify_fault "/path/fault.sh vg1" &nbsp;&nbsp;</=
div><div><span class=3D"Apple-tab-span" style=3D"white-space:pre"=
>		</span>2)=D0=B4=D2=BB=B8=F6=BD=C5=B1=BE=D3=A6=B8=B63=C0=E0=D7=B4=
=BF=F6=B1=D8=D0=EB=C4=DC=BD=D3=CA=DC3=B8=F6=B2=CE=CA=FD$1.$2.$3<s=
pan class=3D"Apple-tab-span" style=3D"white-space:pre">	</span>no=
tify /path/notify.sh</div><div><span class=3D"Apple-tab-span" sty=
le=3D"white-space:pre">		</span>$1 =3D "GROUP" |"INSTANCE" &nbsp;=
 #=B6=D4=C4=C7=B8=F6=D7=E9,=C4=C7=B8=F6=BD=DA=B5=E3=B5=C4=D7=AA=BB=
=BB,</div><div><span class=3D"Apple-tab-span" style=3D"white-spac=
e:pre">		</span>$2 =3D name of group or instance &nbsp; #=D7=E9=BB=
=F2=D5=DF=BD=DA=B5=E3=B5=C4=C3=FB=B3=C6</div><div><span class=3D"=
Apple-tab-span" style=3D"white-space:pre">		</span>$3 =3D target=20=
state of transition ("MASTER"|"BACKUP"|"FAULT") &nbsp;#=D2=AA=D7=AA=
=BB=BB=B3=C9=CA=B2=C3=B4=D7=B4=CC=AC<span class=3D"Apple-tab-span=
" style=3D"white-space:pre">		</span></div><div><br></div><div>MA=
STER=BD=C5=B1=BE</div><div>#!/bin/bash</div><div>#</div><div>vip=3D=
172.16.100.100</div><div>contact=3D'root@localhost'</div><div>thi=
sip=3D`ifconfig eth0 | awk '/inet addr:/{print $2}' | awk -F '{pr=
int $2}'`</div><div><br></div><div>notify() {</div><div><span cla=
ss=3D"Apple-tab-span" style=3D"white-space:pre">	</span>mailbody=3D=
"vrrp transaction,$vip floated to $thisip."</div><div><span class=
=3D"Apple-tab-span" style=3D"white-space:pre">	</span>subject=3D"=
$thisip is to be $vip master"</div><div><span class=3D"Apple-tab-=
span" style=3D"white-space:pre">	</span>echo $mailbody | mail -s=20=
$subject $contact</div><div>}</div><div><br></div><div>notify</di=
v><div><br></div><div><br></div><div>=CF=C2=C3=E6=CA=C7=D2=BB=B8=F6=
notify.sh=BD=C5=B1=BE=B5=C4=BC=F2=B5=A5=CA=BE=C0=FD=A3=BA</div><d=
iv><br></div><div>###############################################=
#</div><div><span class=3D"Apple-tab-span" style=3D"white-space:p=
re">		</span>#!/bin/bash</div><div><span class=3D"Apple-tab-span"=
 style=3D"white-space:pre">		</span># Author: MageEdu &lt;linuxed=
u@foxmail.com&gt;</div><div><span class=3D"Apple-tab-span" style=3D=
"white-space:pre">		</span># description: An example of notify sc=
ript</div><div><span class=3D"Apple-tab-span" style=3D"white-spac=
e:pre">		</span>#&nbsp;</div><div><br></div><div><span class=3D"A=
pple-tab-span" style=3D"white-space:pre">		</span>vip=3D172.16.10=
0.1</div><div><span class=3D"Apple-tab-span" style=3D"white-space=
:pre">		</span>contact=3D'root@localhost'</div><div><br></div><di=
v><span class=3D"Apple-tab-span" style=3D"white-space:pre">		</sp=
an>notify() {</div><div><span class=3D"Apple-tab-span" style=3D"w=
hite-space:pre">			</span>mailsubject=3D"`hostname` to be $1: $vi=
p floating"</div><div><span class=3D"Apple-tab-span" style=3D"whi=
te-space:pre">			</span>mailbody=3D"`date '+%F %H:%M:%S'`: vrrp t=
ransition, `hostname` changed to be $1"</div><div><span class=3D"=
Apple-tab-span" style=3D"white-space:pre">			</span>echo $mailbod=
y | mail -s "$mailsubject" $contact</div><div><span class=3D"Appl=
e-tab-span" style=3D"white-space:pre">		</span>}</div><div><br></=
div><div><span class=3D"Apple-tab-span" style=3D"white-space:pre"=
>		</span>case "$1" in</div><div><span class=3D"Apple-tab-span" s=
tyle=3D"white-space:pre">			</span>master)</div><div><span class=3D=
"Apple-tab-span" style=3D"white-space:pre">				</span>notify mast=
er</div><div><span class=3D"Apple-tab-span" style=3D"white-space:=
pre">				</span>/etc/rc.d/init.d/haproxy start</div><div><span cl=
ass=3D"Apple-tab-span" style=3D"white-space:pre">				</span>exit=20=
0</div><div><span class=3D"Apple-tab-span" style=3D"white-space:p=
re">			</span>;;</div><div><span class=3D"Apple-tab-span" style=3D=
"white-space:pre">			</span>backup)</div><div><span class=3D"Appl=
e-tab-span" style=3D"white-space:pre">				</span>notify backup</d=
iv><div><span class=3D"Apple-tab-span" style=3D"white-space:pre">=
				</span>/etc/rc.d/init.d/haproxy stop</div><div><span class=3D=
"Apple-tab-span" style=3D"white-space:pre">				</span>exit 0</div=
><div><span class=3D"Apple-tab-span" style=3D"white-space:pre">	=09=
	</span>;;</div><div><span class=3D"Apple-tab-span" style=3D"whit=
e-space:pre">			</span>fault)</div><div><span class=3D"Apple-tab-=
span" style=3D"white-space:pre">				</span>notify fault</div><div=
><span class=3D"Apple-tab-span" style=3D"white-space:pre">				</s=
pan>/etc/rc.d/init.d/haproxy stop</div><div><span class=3D"Apple-=
tab-span" style=3D"white-space:pre">				</span>exit 0</div><div><=
span class=3D"Apple-tab-span" style=3D"white-space:pre">			</span=
>;;</div><div><span class=3D"Apple-tab-span" style=3D"white-space=
:pre">			</span>*)</div><div><span class=3D"Apple-tab-span" style=
=3D"white-space:pre">				</span>echo 'Usage: `basename $0` {maste=
r|backup|fault}'</div><div><span class=3D"Apple-tab-span" style=3D=
"white-space:pre">				</span>exit 1</div><div><span class=3D"Appl=
e-tab-span" style=3D"white-space:pre">			</span>;;</div><div><spa=
n class=3D"Apple-tab-span" style=3D"white-space:pre">		</span>esa=
c</div><div><br></div><div><br></div><div><br></div><div><br></di=
v><div>=C5=E4=D6=C3keepalived=CE=AA=CA=B5=CF=D6haproxy=B8=DF=BF=C9=
=D3=C3=B5=C4=CB=AB=D6=F7=C4=A3=D0=CD=C5=E4=D6=C3=CE=C4=BC=FE=CA=BE=
=C0=FD=A3=BA</div><div><br></div><div>=CB=B5=C3=F7=A3=BA=C6=E4=BB=
=F9=B1=BE=CA=B5=CF=D6=CB=BC=CF=EB=CE=AA=B4=B4=BD=A8=C1=BD=B8=F6=D0=
=E9=C4=E2=C2=B7=D3=C9=C6=F7=A3=AC=B2=A2=D2=D4=C1=BD=B8=F6=BD=DA=B5=
=E3=BB=A5=CE=AA=D6=F7=B4=D3=A1=A3</div><div><br></div><div>######=
#</div><div><span class=3D"Apple-tab-span" style=3D"white-space:p=
re">		</span>! Configuration File for keepalived &nbsp;</div><div=
><span class=3D"Apple-tab-span" style=3D"white-space:pre">		</spa=
n> &nbsp;</div><div><span class=3D"Apple-tab-span" style=3D"white=
-space:pre">		</span>global_defs { &nbsp;</div><div><span class=3D=
"Apple-tab-span" style=3D"white-space:pre">		</span> &nbsp; notif=
ication_email { &nbsp;</div><div><span class=3D"Apple-tab-span" s=
tyle=3D"white-space:pre">				</span> linuxedu@foxmail.com</div><d=
iv><span class=3D"Apple-tab-span" style=3D"white-space:pre">				<=
/span> mageedu@126.com &nbsp;</div><div><span class=3D"Apple-tab-=
span" style=3D"white-space:pre">		</span> &nbsp; } &nbsp;</div><d=
iv><span class=3D"Apple-tab-span" style=3D"white-space:pre">		</s=
pan> &nbsp; notification_email_from kanotify@magedu.com&nbsp;</di=
v><div><span class=3D"Apple-tab-span" style=3D"white-space:pre">=09=
	</span> &nbsp; smtp_connect_timeout 3 &nbsp;</div><div><span cla=
ss=3D"Apple-tab-span" style=3D"white-space:pre">		</span> &nbsp;=20=
smtp_server 127.0.0.1 &nbsp;</div><div><span class=3D"Apple-tab-s=
pan" style=3D"white-space:pre">		</span> &nbsp; router_id LVS_DEV=
EL &nbsp;</div><div><span class=3D"Apple-tab-span" style=3D"white=
-space:pre">		</span>} &nbsp;</div><div><br></div><div><span clas=
s=3D"Apple-tab-span" style=3D"white-space:pre">		</span>vrrp_scri=
pt chk_haproxy { &nbsp;</div><div><span class=3D"Apple-tab-span"=20=
style=3D"white-space:pre">			</span>script "killall -0 haproxy" &=
nbsp;</div><div><span class=3D"Apple-tab-span" style=3D"white-spa=
ce:pre">			</span>interval 1 &nbsp;</div><div><span class=3D"Appl=
e-tab-span" style=3D"white-space:pre">			</span>weight 2 &nbsp;</=
div><div><span class=3D"Apple-tab-span" style=3D"white-space:pre"=
>		</span>} &nbsp;</div><div><br></div><div><span class=3D"Apple-=
tab-span" style=3D"white-space:pre">		</span>vrrp_script chk_mant=
aince_down {</div><div><span class=3D"Apple-tab-span" style=3D"wh=
ite-space:pre">		</span> &nbsp; script "[[ -f /etc/keepalived/dow=
n ]] &amp;&amp; exit 1 || exit 0"</div><div><span class=3D"Apple-=
tab-span" style=3D"white-space:pre">		</span> &nbsp; interval 1</=
div><div><span class=3D"Apple-tab-span" style=3D"white-space:pre"=
>		</span> &nbsp; weight 2</div><div><span class=3D"Apple-tab-spa=
n" style=3D"white-space:pre">		</span>}</div><div><br></div><div>=
<span class=3D"Apple-tab-span" style=3D"white-space:pre">		</span=
>vrrp_instance VI_1 { &nbsp;</div><div><span class=3D"Apple-tab-s=
pan" style=3D"white-space:pre">			</span>interface eth0 &nbsp;</d=
iv><div><span class=3D"Apple-tab-span" style=3D"white-space:pre">=
			</span>state MASTER &nbsp;# BACKUP for slave routers</div><div=
><span class=3D"Apple-tab-span" style=3D"white-space:pre">			</sp=
an>priority 101 &nbsp;# 100 for BACKUP</div><div><span class=3D"A=
pple-tab-span" style=3D"white-space:pre">			</span>virtual_router=
_id 51&nbsp;</div><div><span class=3D"Apple-tab-span" style=3D"wh=
ite-space:pre">			</span>garp_master_delay 1&nbsp;</div><div><spa=
n class=3D"Apple-tab-span" style=3D"white-space:pre">		</span> &n=
bsp;</div><div><span class=3D"Apple-tab-span" style=3D"white-spac=
e:pre">			</span>authentication { &nbsp;</div><div><span class=3D=
"Apple-tab-span" style=3D"white-space:pre">				</span>auth_type P=
ASS &nbsp;</div><div><span class=3D"Apple-tab-span" style=3D"whit=
e-space:pre">				</span>auth_pass password &nbsp;</div><div><span=
 class=3D"Apple-tab-span" style=3D"white-space:pre">			</span>} &=
nbsp;</div><div><span class=3D"Apple-tab-span" style=3D"white-spa=
ce:pre">			</span>track_interface { &nbsp;</div><div><span class=3D=
"Apple-tab-span" style=3D"white-space:pre">			</span> &nbsp; eth0=
 &nbsp; &nbsp;</div><div><span class=3D"Apple-tab-span" style=3D"=
white-space:pre">			</span>} &nbsp;</div><div><span class=3D"Appl=
e-tab-span" style=3D"white-space:pre">			</span>virtual_ipaddress=
 { &nbsp;</div><div><span class=3D"Apple-tab-span" style=3D"white=
-space:pre">				</span>172.16.100.1/16 dev eth0 label eth0:0&nbsp=
;</div><div><span class=3D"Apple-tab-span" style=3D"white-space:p=
re">			</span>} &nbsp;</div><div><span class=3D"Apple-tab-span" s=
tyle=3D"white-space:pre">			</span>track_script { &nbsp;</div><di=
v><span class=3D"Apple-tab-span" style=3D"white-space:pre">				</=
span>chk_haproxy &nbsp;</div><div><span class=3D"Apple-tab-span"=20=
style=3D"white-space:pre">				</span>chk_mantaince_down</div><div=
><span class=3D"Apple-tab-span" style=3D"white-space:pre">			</sp=
an>} &nbsp;</div><div><span class=3D"Apple-tab-span" style=3D"whi=
te-space:pre">		</span> &nbsp;</div><div><span class=3D"Apple-tab=
-span" style=3D"white-space:pre">		</span>&nbsp;</div><div><span=20=
class=3D"Apple-tab-span" style=3D"white-space:pre">			</span>noti=
fy_master "/etc/keepalived/notify.sh master" &nbsp;</div><div><sp=
an class=3D"Apple-tab-span" style=3D"white-space:pre">			</span>n=
otify_backup "/etc/keepalived/notify.sh backup" &nbsp;</div><div>=
<span class=3D"Apple-tab-span" style=3D"white-space:pre">			</spa=
n>notify_fault "/etc/keepalived/notify.sh fault" &nbsp;</div><div=
><span class=3D"Apple-tab-span" style=3D"white-space:pre">		</spa=
n>}&nbsp;</div><div><br></div><div><span class=3D"Apple-tab-span"=
 style=3D"white-space:pre">		</span>vrrp_instance VI_2 { &nbsp;</=
div><div><span class=3D"Apple-tab-span" style=3D"white-space:pre"=
>			</span>interface eth0 &nbsp;</div><div><span class=3D"Apple-t=
ab-span" style=3D"white-space:pre">			</span>state BACKUP &nbsp;#=
 BACKUP for slave routers</div><div><span class=3D"Apple-tab-span=
" style=3D"white-space:pre">			</span>priority 100 &nbsp;# 100 fo=
r BACKUP</div><div><span class=3D"Apple-tab-span" style=3D"white-=
space:pre">			</span>virtual_router_id 52</div><div><span class=3D=
"Apple-tab-span" style=3D"white-space:pre">			</span>garp_master_=
delay 1&nbsp;</div><div><span class=3D"Apple-tab-span" style=3D"w=
hite-space:pre">		</span> &nbsp;</div><div><span class=3D"Apple-t=
ab-span" style=3D"white-space:pre">			</span>authentication { &nb=
sp;</div><div><span class=3D"Apple-tab-span" style=3D"white-space=
:pre">				</span>auth_type PASS &nbsp;</div><div><span class=3D"A=
pple-tab-span" style=3D"white-space:pre">				</span>auth_pass pas=
sword &nbsp;</div><div><span class=3D"Apple-tab-span" style=3D"wh=
ite-space:pre">			</span>} &nbsp;</div><div><span class=3D"Apple-=
tab-span" style=3D"white-space:pre">			</span>track_interface { &=
nbsp;</div><div><span class=3D"Apple-tab-span" style=3D"white-spa=
ce:pre">			</span> &nbsp; eth0 &nbsp; &nbsp;</div><div><span clas=
s=3D"Apple-tab-span" style=3D"white-space:pre">			</span>} &nbsp;=
</div><div><span class=3D"Apple-tab-span" style=3D"white-space:pr=
e">			</span>virtual_ipaddress { &nbsp;</div><div><span class=3D"=
Apple-tab-span" style=3D"white-space:pre">				</span>172.16.100.2=
/16 dev eth0 label eth0:1</div><div><span class=3D"Apple-tab-span=
" style=3D"white-space:pre">			</span>} &nbsp;</div><div><span cl=
ass=3D"Apple-tab-span" style=3D"white-space:pre">			</span>track_=
script { &nbsp;</div><div><span class=3D"Apple-tab-span" style=3D=
"white-space:pre">				</span>chk_haproxy &nbsp;</div><div><span c=
lass=3D"Apple-tab-span" style=3D"white-space:pre">				</span>chk_=
mantaince_down</div><div><span class=3D"Apple-tab-span" style=3D"=
white-space:pre">			</span>} &nbsp; &nbsp;</div><div><span class=3D=
"Apple-tab-span" style=3D"white-space:pre">		</span>}</div><div><=
br></div><div><br></div><div><span class=3D"Apple-tab-span" style=
=3D"white-space:pre">		</span>=CB=B5=C3=F7=A3=BA</div><div><span=20=
class=3D"Apple-tab-span" style=3D"white-space:pre">		</span>1=A1=A2=
=B6=D4=D3=DAVI_1=BA=CDVI_2=C0=B4=CB=B5=A3=AC=C1=BD=B8=F6=BD=DA=B5=
=E3=D2=AA=BB=A5=CE=AA=D6=F7=B4=D3=B9=D8=CF=B5=A3=BB</div><div><br=
></div><div>=C5=E4=D6=C3keepalived=CE=AA=CA=B5=CF=D6nginx=B8=DF=BF=
=C9=D3=C3=B5=C4=CB=AB=D6=F7=C4=A3=D0=CD=C5=E4=D6=C3=CE=C4=BC=FE=CA=
=BE=C0=FD=A3=BA172.16.100.15 node1.magedu.com &nbsp;172.16.100.16=
 node2.magedu.com vip=3D172.16.100.100 172.16.100.200</div><div><=
span class=3D"Apple-tab-span" style=3D"white-space:pre">		</span>=
1,=BC=E0=BF=D8=B7=FE=CE=F1=BD=C5=B1=BE vrrp_script {}</div><div><=
span class=3D"Apple-tab-span" style=3D"white-space:pre">		</span>=
2.=D4=DAvrrp=CA=B5=C0=FD=D6=D0=D7=B7=D7=D9=B7=FE=CE=F1 &nbsp;trac=
k_scipt</div><div><span class=3D"Apple-tab-span" style=3D"white-s=
pace:pre">		</span>3,=CD=A8=B9=FD=B7=FE=CE=F1=CD=A8=D6=AA=BD=C5=B1=
=BE=C6=F4=B6=AF=B7=FE=CE=F1</div><div>##################2=B8=F6=BC=
=B8=B5=E3=D4=DAVI_1, VI_2=BB=A5=CE=AA=D6=F7=B4=D3</div><div><span=
 class=3D"Apple-tab-span" style=3D"white-space:pre">		</span>glob=
al_defs { &nbsp;</div><div><span class=3D"Apple-tab-span" style=3D=
"white-space:pre">		</span> &nbsp; notification_email { &nbsp;</d=
iv><div><span class=3D"Apple-tab-span" style=3D"white-space:pre">=
				</span> root@localhost</div><div><span class=3D"Apple-tab-spa=
n" style=3D"white-space:pre">		</span> &nbsp; } &nbsp;</div><div>=
<span class=3D"Apple-tab-span" style=3D"white-space:pre">		</span=
> &nbsp; notification_email_from kaadmin@magedu.com&nbsp;</div><d=
iv><span class=3D"Apple-tab-span" style=3D"white-space:pre">		</s=
pan> &nbsp; smtp_connect_timeout 30 &nbsp;</div><div><span class=3D=
"Apple-tab-span" style=3D"white-space:pre">		</span> &nbsp; smtp_=
server 127.0.0.1 &nbsp;</div><div><span class=3D"Apple-tab-span"=20=
style=3D"white-space:pre">		</span> &nbsp; router_id LVS_DEVEL &n=
bsp;</div><div><span class=3D"Apple-tab-span" style=3D"white-spac=
e:pre">		</span>} &nbsp;</div><div><br></div><div><span class=3D"=
Apple-tab-span" style=3D"white-space:pre">		</span>vrrp_script ch=
k_nginx { &nbsp;</div><div><span class=3D"Apple-tab-span" style=3D=
"white-space:pre">			</span>script "killall -0 nginx "</div><div>=
<span class=3D"Apple-tab-span" style=3D"white-space:pre">			</spa=
n>interval 1 &nbsp;</div><div><span class=3D"Apple-tab-span" styl=
e=3D"white-space:pre">			</span>weight 2</div><div><span class=3D=
"Apple-tab-span" style=3D"white-space:pre">			</span>fall 2 &nbsp=
;#=CA=A7=B0=DC=BC=EC=B2=E2=BC=B8=B4=CE,=B2=C5=D5=E6=D5=FD=CA=A7=B0=
=DC</div><div><span class=3D"Apple-tab-span" style=3D"white-space=
:pre">		</span> &nbsp; &nbsp;rise 1 &nbsp;#=B3=C9=B9=A6=BC=EC=B2=E2=
=BC=B8=B4=CE</div><div><span class=3D"Apple-tab-span" style=3D"wh=
ite-space:pre">		</span>} &nbsp;</div><div><br></div><div><span c=
lass=3D"Apple-tab-span" style=3D"white-space:pre">		</span>vrrp_s=
cript chk_mantaince_down {<span class=3D"Apple-tab-span" style=3D=
"white-space:pre">										</span>#vrrp_script chk_mantaince{</d=
iv><div><span class=3D"Apple-tab-span" style=3D"white-space:pre">=
		</span> &nbsp; script "[[ -f /etc/keepalived/down ]] &amp;&amp;=
 exit 1 || exit 0"<span class=3D"Apple-tab-span" style=3D"white-s=
pace:pre">			</span>#<span class=3D"Apple-tab-span" style=3D"whit=
e-space:pre">	</span>script "[[ -e /etc/keepalived/down]] &amp;&a=
mp; exit 1 ||exit 0"</div><div><span class=3D"Apple-tab-span" sty=
le=3D"white-space:pre">		</span> &nbsp; interval 1<span class=3D"=
Apple-tab-span" style=3D"white-space:pre">															</span>#=
<span class=3D"Apple-tab-span" style=3D"white-space:pre">	</span>=
interval 1&nbsp;</div><div><span class=3D"Apple-tab-span" style=3D=
"white-space:pre">		</span> &nbsp; weight 2<span class=3D"Apple-t=
ab-span" style=3D"white-space:pre">														</span> &nbsp; <=
span class=3D"Apple-tab-span" style=3D"white-space:pre">		</span>=
#<span class=3D"Apple-tab-span" style=3D"white-space:pre">	</span=
>weiget -2</div><div><span class=3D"Apple-tab-span" style=3D"whit=
e-space:pre">		</span>}</div><div><br></div><div><span class=3D"A=
pple-tab-span" style=3D"white-space:pre">		</span>vrrp_instance V=
I_1 { &nbsp;</div><div><span class=3D"Apple-tab-span" style=3D"wh=
ite-space:pre">			</span>interface eth0 &nbsp;</div><div><span cl=
ass=3D"Apple-tab-span" style=3D"white-space:pre">			</span>state=20=
MASTER &nbsp;# BACKUP for slave routers</div><div><span class=3D"=
Apple-tab-span" style=3D"white-space:pre">			</span>priority 101=20=
&nbsp;# 100 for BACKUP</div><div><span class=3D"Apple-tab-span" s=
tyle=3D"white-space:pre">			</span>virtual_router_id 51&nbsp;</di=
v><div><span class=3D"Apple-tab-span" style=3D"white-space:pre">=09=
		</span>garp_master_delay 1&nbsp;</div><div><span class=3D"Apple=
-tab-span" style=3D"white-space:pre">		</span> &nbsp;</div><div><=
span class=3D"Apple-tab-span" style=3D"white-space:pre">			</span=
>authentication { &nbsp;</div><div><span class=3D"Apple-tab-span"=
 style=3D"white-space:pre">				</span>auth_type PASS &nbsp;</div>=
<div><span class=3D"Apple-tab-span" style=3D"white-space:pre">		=09=
	</span>auth_pass password1 &nbsp;</div><div><span class=3D"Apple=
-tab-span" style=3D"white-space:pre">			</span>} &nbsp;</div><div=
><span class=3D"Apple-tab-span" style=3D"white-space:pre">			</sp=
an>track_interface { &nbsp;</div><div><span class=3D"Apple-tab-sp=
an" style=3D"white-space:pre">			</span> &nbsp; eth0 &nbsp; &nbsp=
;</div><div><span class=3D"Apple-tab-span" style=3D"white-space:p=
re">			</span>} &nbsp;</div><div><span class=3D"Apple-tab-span" s=
tyle=3D"white-space:pre">			</span>virtual_ipaddress { &nbsp;</di=
v><div><span class=3D"Apple-tab-span" style=3D"white-space:pre">=09=
			</span>172.16.100.100/16 dev eth0 label eth0:0&nbsp;</div><div=
><span class=3D"Apple-tab-span" style=3D"white-space:pre">			</sp=
an>} &nbsp;</div><div><span class=3D"Apple-tab-span" style=3D"whi=
te-space:pre">			</span>track_script { &nbsp;</div><div><span cla=
ss=3D"Apple-tab-span" style=3D"white-space:pre">				</span>chk_ng=
inx &nbsp;</div><div><span class=3D"Apple-tab-span" style=3D"whit=
e-space:pre">				</span>chk_mantaince_down</div><div><span class=3D=
"Apple-tab-span" style=3D"white-space:pre">			</span>} &nbsp;</di=
v><div><span class=3D"Apple-tab-span" style=3D"white-space:pre">=09=
	</span> &nbsp;</div><div><span class=3D"Apple-tab-span" style=3D=
"white-space:pre">		</span>&nbsp;</div><div><span class=3D"Apple-=
tab-span" style=3D"white-space:pre">			</span>notify_master "/etc=
/keepalived/notify.sh master" &nbsp;</div><div><span class=3D"App=
le-tab-span" style=3D"white-space:pre">			</span>notify_backup "/=
etc/keepalived/notify.sh backup" &nbsp;</div><div><span class=3D"=
Apple-tab-span" style=3D"white-space:pre">			</span>notify_fault=20=
"/etc/keepalived/notify.sh fault" &nbsp;</div><div><span class=3D=
"Apple-tab-span" style=3D"white-space:pre">		</span>}&nbsp;</div>=
<div><br></div><div><span class=3D"Apple-tab-span" style=3D"white=
-space:pre">		</span>vrrp_instance VI_2 { &nbsp;</div><div><span=20=
class=3D"Apple-tab-span" style=3D"white-space:pre">			</span>inte=
rface eth0 &nbsp;</div><div><span class=3D"Apple-tab-span" style=3D=
"white-space:pre">			</span>state BACKUP &nbsp;# BACKUP for slave=
 routers</div><div><span class=3D"Apple-tab-span" style=3D"white-=
space:pre">			</span>priority 100 &nbsp;# 100 for BACKUP</div><di=
v><span class=3D"Apple-tab-span" style=3D"white-space:pre">			</s=
pan>virtual_router_id 52</div><div><span class=3D"Apple-tab-span"=
 style=3D"white-space:pre">			</span>garp_master_delay 1&nbsp;</d=
iv><div><span class=3D"Apple-tab-span" style=3D"white-space:pre">=
		</span> &nbsp;</div><div><span class=3D"Apple-tab-span" style=3D=
"white-space:pre">			</span>authentication { &nbsp;</div><div><sp=
an class=3D"Apple-tab-span" style=3D"white-space:pre">				</span>=
auth_type PASS &nbsp;</div><div><span class=3D"Apple-tab-span" st=
yle=3D"white-space:pre">				</span>auth_pass password2 &nbsp;</di=
v><div><span class=3D"Apple-tab-span" style=3D"white-space:pre">=09=
		</span>} &nbsp;</div><div><span class=3D"Apple-tab-span" style=3D=
"white-space:pre">			</span>track_interface { &nbsp;</div><div><s=
pan class=3D"Apple-tab-span" style=3D"white-space:pre">			</span>=
 &nbsp; eth0 &nbsp; &nbsp;</div><div><span class=3D"Apple-tab-spa=
n" style=3D"white-space:pre">			</span>} &nbsp;</div><div><span c=
lass=3D"Apple-tab-span" style=3D"white-space:pre">			</span>virtu=
al_ipaddress { &nbsp;</div><div><span class=3D"Apple-tab-span" st=
yle=3D"white-space:pre">				</span>172.16.100.200/16 dev eth0 lab=
el eth0:1</div><div><span class=3D"Apple-tab-span" style=3D"white=
-space:pre">			</span>} &nbsp;</div><div><span class=3D"Apple-tab=
-span" style=3D"white-space:pre">			</span>track_script { &nbsp;<=
/div><div><span class=3D"Apple-tab-span" style=3D"white-space:pre=
">				</span>chk_haproxy &nbsp;</div><div><span class=3D"Apple-ta=
b-span" style=3D"white-space:pre">				</span>chk_mantaince_down</=
div><div><span class=3D"Apple-tab-span" style=3D"white-space:pre"=
>			</span>} &nbsp; &nbsp;</div><div><span class=3D"Apple-tab-spa=
n" style=3D"white-space:pre">		</span>}</div><div><span class=3D"=
Apple-tab-span" style=3D"white-space:pre">		</span></div><div>###=
############notify.sh=BD=C5=B1=BE=B5=C4=BC=F2=B5=A5=CA=BE=C0=FD=A3=
=BA################################################</div><div><sp=
an class=3D"Apple-tab-span" style=3D"white-space:pre">		</span>#!=
/bin/bash</div><div><span class=3D"Apple-tab-span" style=3D"white=
-space:pre">		</span># Author: MageEdu &lt;linuxedu@foxmail.com&g=
t;</div><div><span class=3D"Apple-tab-span" style=3D"white-space:=
pre">		</span># description: An example of notify script</div><di=
v><span class=3D"Apple-tab-span" style=3D"white-space:pre">		</sp=
an>#&nbsp;</div><div><br></div><div><span class=3D"Apple-tab-span=
" style=3D"white-space:pre">		</span>vip=3D172.16.100.100</div><d=
iv><span class=3D"Apple-tab-span" style=3D"white-space:pre">		</s=
pan>contact=3D'root@localhost'</div><div><br></div><div><span cla=
ss=3D"Apple-tab-span" style=3D"white-space:pre">		</span>notify()=
 {</div><div><span class=3D"Apple-tab-span" style=3D"white-space:=
pre">			</span>mailsubject=3D"`hostname` to be $1: $vip floating"=
</div><div><span class=3D"Apple-tab-span" style=3D"white-space:pr=
e">			</span>mailbody=3D"`date '+%F %H:%M:%S'`: vrrp transition,=20=
`hostname` changed to be $1"</div><div><span class=3D"Apple-tab-s=
pan" style=3D"white-space:pre">			</span>echo $mailbody | mail -s=
 "$mailsubject" $contact</div><div><span class=3D"Apple-tab-span"=
 style=3D"white-space:pre">		</span>}</div><div><br></div><div><s=
pan class=3D"Apple-tab-span" style=3D"white-space:pre">		</span>c=
ase "$1" in</div><div><span class=3D"Apple-tab-span" style=3D"whi=
te-space:pre">			</span>master)</div><div><span class=3D"Apple-ta=
b-span" style=3D"white-space:pre">				</span>notify master</div><=
div><span class=3D"Apple-tab-span" style=3D"white-space:pre">			=09=
</span>/etc/rc.d/init.d/nginx start</div><div><span class=3D"Appl=
e-tab-span" style=3D"white-space:pre">				</span>exit 0</div><div=
><span class=3D"Apple-tab-span" style=3D"white-space:pre">			</sp=
an>;;</div><div><span class=3D"Apple-tab-span" style=3D"white-spa=
ce:pre">			</span>backup)</div><div><span class=3D"Apple-tab-span=
" style=3D"white-space:pre">				</span>notify backup</div><div><s=
pan class=3D"Apple-tab-span" style=3D"white-space:pre">				</span=
>/etc/rc.d/init.d/nginx stop</div><div><span class=3D"Apple-tab-s=
pan" style=3D"white-space:pre">				</span>exit 0</div><div><span=20=
class=3D"Apple-tab-span" style=3D"white-space:pre">			</span>;;</=
div><div><span class=3D"Apple-tab-span" style=3D"white-space:pre"=
>			</span>fault)</div><div><span class=3D"Apple-tab-span" style=3D=
"white-space:pre">				</span>notify fault</div><div><span class=3D=
"Apple-tab-span" style=3D"white-space:pre">				</span>/etc/rc.d/i=
nit.d/nginx stop</div><div><span class=3D"Apple-tab-span" style=3D=
"white-space:pre">				</span>exit 0</div><div><span class=3D"Appl=
e-tab-span" style=3D"white-space:pre">			</span>;;</div><div><spa=
n class=3D"Apple-tab-span" style=3D"white-space:pre">			</span>*)=
</div><div><span class=3D"Apple-tab-span" style=3D"white-space:pr=
e">				</span>echo 'Usage: `basename $0` {master|backup|fault}'</=
div><div><span class=3D"Apple-tab-span" style=3D"white-space:pre"=
>				</span>exit 1</div><div><span class=3D"Apple-tab-span" style=
=3D"white-space:pre">			</span>;;</div><div><span class=3D"Apple-=
tab-span" style=3D"white-space:pre">		</span>esac</div><div><br><=
/div><div><br></div><div><br></div><div><br></div><div><br></div>=
<div><br></div><div><br></div><div><br></div><div><br></div><div>=
LVS + keepalived=B5=C4=C5=E4=D6=C3=A3=BA</div><div><span class=3D=
"Apple-tab-span" style=3D"white-space:pre">	</span>protocol TCP &=
nbsp; #=BC=AF=C8=BA=B7=FE=CE=F1=B5=C4=D0=AD=D2=E9,=D6=BB=D6=A7=B3=
=D6TCP,=B2=BB=D6=A7=B3=D6UDP</div><div><span class=3D"Apple-tab-s=
pan" style=3D"white-space:pre">	</span>virtual_server IP PORT {}=20=
&nbsp; <span class=3D"Apple-tab-span" style=3D"white-space:pre">=09=
</span>#LVS=B5=C4=BC=AF=C8=BA=B7=FE=CE=F1</div><div><span class=3D=
"Apple-tab-span" style=3D"white-space:pre">	</span>virtual_server=
 fwmark int {}<span class=3D"Apple-tab-span" style=3D"white-space=
:pre">	</span>#LVS=BC=AF=C8=BA=B7=FE=CE=F1=B7=C0=BB=F0=C7=BD=B1=EA=
=BC=C7</div><div><span class=3D"Apple-tab-span" style=3D"white-sp=
ace:pre">	</span>virtual_server GROUP STRING {} &nbsp;#=BC=AF=C8=BA=
=B7=FE=CE=F1=B5=C4=D7=E9=C3=FB</div><div><span class=3D"Apple-tab=
-span" style=3D"white-space:pre">		</span>lb_algo &nbsp;rr|wrr...=
 &nbsp;#=B8=BA=D4=D8=BE=F9=BA=E2=B5=C4=CB=E3=B7=A8</div><div><spa=
n class=3D"Apple-tab-span" style=3D"white-space:pre">		</span>lb_=
kind NAT|DR|TUN #LVS=C0=E0=D0=CD</div><div><span class=3D"Apple-t=
ab-span" style=3D"white-space:pre">		</span>persistence_timeout #=
=B3=D6=BE=C3=C1=AC=BD=D3=B5=C4=CA=B1=B3=A4</div><div><span class=3D=
"Apple-tab-span" style=3D"white-space:pre">		</span>sorry_server=20=
&nbsp;IP PORT &nbsp; #LVS=BC=AF=C8=BA=B9=D2=C1=CB,=CB=F9=CC=E1=B9=
=A9=B5=C4=B4=ED=CE=F3=CC=E1=CA=BE=B7=FE=CE=F1=C6=F7</div><div><sp=
an class=3D"Apple-tab-span" style=3D"white-space:pre">		</span>re=
al_server IPADDR PORT{}</div><div><span class=3D"Apple-tab-span"=20=
style=3D"white-space:pre">			</span>weight INT #=D3=C5=CF=C8=BC=B6=
</div><div><span class=3D"Apple-tab-span" style=3D"white-space:pr=
e">			</span>notify_up STRING|QUOTED-STRING # =CD=A8=D6=AA=BD=C5=B1=
=BE</div><div><span class=3D"Apple-tab-span" style=3D"white-space=
:pre">			</span>notify_down STRING|QUOTED-STRING &nbsp;#=CD=A8=D6=
=AA=BD=C5=B1=BE</div><div><span class=3D"Apple-tab-span" style=3D=
"white-space:pre">			</span>#HTTP_GET|SSL_GET|TCP_CHECK|SMTP_CHEC=
K|MISC_CHECK &nbsp;#=BD=A1=BF=B5=D7=B4=CC=AC=BC=EC=B2=E2</div><di=
v><span class=3D"Apple-tab-span" style=3D"white-space:pre">			</s=
pan></div><div><br></div><div>###################################=
#</div><div><span class=3D"Apple-tab-span" style=3D"white-space:p=
re">		</span>! Configuration File for keepalived &nbsp;</div><div=
><span class=3D"Apple-tab-span" style=3D"white-space:pre">		</spa=
n> &nbsp;</div><div><span class=3D"Apple-tab-span" style=3D"white=
-space:pre">		</span>global_defs { &nbsp;</div><div><span class=3D=
"Apple-tab-span" style=3D"white-space:pre">		</span> &nbsp; notif=
ication_email { &nbsp;</div><div><span class=3D"Apple-tab-span" s=
tyle=3D"white-space:pre">				</span> linuxedu@foxmail.com</div><d=
iv><span class=3D"Apple-tab-span" style=3D"white-space:pre">				<=
/span> mageedu@126.com &nbsp;</div><div><span class=3D"Apple-tab-=
span" style=3D"white-space:pre">		</span> &nbsp; } &nbsp;</div><d=
iv><span class=3D"Apple-tab-span" style=3D"white-space:pre">		</s=
pan> &nbsp; notification_email_from kanotify@magedu.com&nbsp;</di=
v><div><span class=3D"Apple-tab-span" style=3D"white-space:pre">=09=
	</span> &nbsp; smtp_connect_timeout 3 &nbsp;</div><div><span cla=
ss=3D"Apple-tab-span" style=3D"white-space:pre">		</span> &nbsp;=20=
smtp_server 127.0.0.1 &nbsp;</div><div><span class=3D"Apple-tab-s=
pan" style=3D"white-space:pre">		</span> &nbsp; router_id LVS_DEV=
EL &nbsp;</div><div><span class=3D"Apple-tab-span" style=3D"white=
-space:pre">		</span>} &nbsp;</div><div><br></div><div><span clas=
s=3D"Apple-tab-span" style=3D"white-space:pre">		</span>vrrp_scri=
pt chk_schedown {</div><div><span class=3D"Apple-tab-span" style=3D=
"white-space:pre">		</span> &nbsp; script "[[ -f /etc/keepalived/=
down ]] &amp;&amp; exit 1 || exit 0"</div><div><span class=3D"App=
le-tab-span" style=3D"white-space:pre">		</span> &nbsp; interval=20=
2</div><div><span class=3D"Apple-tab-span" style=3D"white-space:p=
re">		</span> &nbsp; weight -2</div><div><span class=3D"Apple-tab=
-span" style=3D"white-space:pre">		</span>}</div><div><br></div><=
div><span class=3D"Apple-tab-span" style=3D"white-space:pre">		</=
span>vrrp_instance VI_1 { &nbsp;</div><div><span class=3D"Apple-t=
ab-span" style=3D"white-space:pre">			</span>interface eth0 &nbsp=
;</div><div><span class=3D"Apple-tab-span" style=3D"white-space:p=
re">			</span>state MASTER &nbsp;</div><div><span class=3D"Apple-=
tab-span" style=3D"white-space:pre">			</span>priority 101</div><=
div><span class=3D"Apple-tab-span" style=3D"white-space:pre">			<=
/span>virtual_router_id 51&nbsp;</div><div><span class=3D"Apple-t=
ab-span" style=3D"white-space:pre">			</span>garp_master_delay 1&=
nbsp;</div><div><span class=3D"Apple-tab-span" style=3D"white-spa=
ce:pre">		</span>&nbsp;</div><div><span class=3D"Apple-tab-span"=20=
style=3D"white-space:pre">			</span>authentication { &nbsp;</div>=
<div><span class=3D"Apple-tab-span" style=3D"white-space:pre">		=09=
	</span>auth_type PASS &nbsp;</div><div><span class=3D"Apple-tab-=
span" style=3D"white-space:pre">				</span>auth_pass password &nb=
sp;</div><div><span class=3D"Apple-tab-span" style=3D"white-space=
:pre">			</span>} &nbsp;</div><div><br></div><div><span class=3D"=
Apple-tab-span" style=3D"white-space:pre">			</span>track_interfa=
ce { &nbsp;</div><div><span class=3D"Apple-tab-span" style=3D"whi=
te-space:pre">			</span> &nbsp; eth0 &nbsp; &nbsp;</div><div><spa=
n class=3D"Apple-tab-span" style=3D"white-space:pre">			</span>}=20=
&nbsp;</div><div><br></div><div><span class=3D"Apple-tab-span" st=
yle=3D"white-space:pre">			</span>virtual_ipaddress { &nbsp;</div=
><div><span class=3D"Apple-tab-span" style=3D"white-space:pre">	=09=
		</span>172.16.100.1/16 dev eth0 label eth0:0</div><div><span cl=
ass=3D"Apple-tab-span" style=3D"white-space:pre">			</span>} &nbs=
p;</div><div><br></div><div><span class=3D"Apple-tab-span" style=3D=
"white-space:pre">			</span>track_script { &nbsp;</div><div><span=
 class=3D"Apple-tab-span" style=3D"white-space:pre">				</span>ch=
k_schedown</div><div><span class=3D"Apple-tab-span" style=3D"whit=
e-space:pre">			</span>} &nbsp; &nbsp;</div><div><span class=3D"A=
pple-tab-span" style=3D"white-space:pre">		</span>}&nbsp;</div><d=
iv><br></div><div><br></div><div><span class=3D"Apple-tab-span" s=
tyle=3D"white-space:pre">		</span>virtual_server 172.16.100.1 80=20=
{</div><div><span class=3D"Apple-tab-span" style=3D"white-space:p=
re">			</span>delay_loop 6</div><div><span class=3D"Apple-tab-spa=
n" style=3D"white-space:pre">			</span>lb_algo rr&nbsp;</div><div=
><span class=3D"Apple-tab-span" style=3D"white-space:pre">			</sp=
an>lb_kind DR</div><div><span class=3D"Apple-tab-span" style=3D"w=
hite-space:pre">			</span>persistence_timeout 50</div><div><span=20=
class=3D"Apple-tab-span" style=3D"white-space:pre">			</span>prot=
ocol TCP</div><div><br></div><div><span class=3D"Apple-tab-span"=20=
style=3D"white-space:pre">		</span># &nbsp; &nbsp;sorry_server 19=
2.168.200.200 1358</div><div><br></div><div><span class=3D"Apple-=
tab-span" style=3D"white-space:pre">			</span>real_server 172.16.=
100.11 80 {</div><div><span class=3D"Apple-tab-span" style=3D"whi=
te-space:pre">				</span>weight 1</div><div><span class=3D"Apple-=
tab-span" style=3D"white-space:pre">				</span>HTTP_GET {</div><d=
iv><span class=3D"Apple-tab-span" style=3D"white-space:pre">				=09=
</span>url {&nbsp;</div><div><span class=3D"Apple-tab-span" style=
=3D"white-space:pre">					</span> &nbsp;path /</div><div><span cl=
ass=3D"Apple-tab-span" style=3D"white-space:pre">					</span> &nb=
sp;status_code 200</div><div><span class=3D"Apple-tab-span" style=
=3D"white-space:pre">					</span>}</div><div><span class=3D"Apple=
-tab-span" style=3D"white-space:pre">					</span>connect_timeout=20=
3</div><div><span class=3D"Apple-tab-span" style=3D"white-space:p=
re">					</span>nb_get_retry 3</div><div><span class=3D"Apple-tab=
-span" style=3D"white-space:pre">					</span>delay_before_retry 3=
</div><div><span class=3D"Apple-tab-span" style=3D"white-space:pr=
e">				</span>}</div><div><span class=3D"Apple-tab-span" style=3D=
"white-space:pre">			</span>}</div><div><br></div><div><span clas=
s=3D"Apple-tab-span" style=3D"white-space:pre">			</span>real_ser=
ver 172.16.100.12 80 {</div><div><span class=3D"Apple-tab-span" s=
tyle=3D"white-space:pre">				</span>weight 1</div><div><span clas=
s=3D"Apple-tab-span" style=3D"white-space:pre">				</span>HTTP_GE=
T {</div><div><span class=3D"Apple-tab-span" style=3D"white-space=
:pre">					</span>url {&nbsp;</div><div><span class=3D"Apple-tab-=
span" style=3D"white-space:pre">					</span> &nbsp;path /</div><d=
iv><span class=3D"Apple-tab-span" style=3D"white-space:pre">				=09=
</span> &nbsp;status_code 200</div><div><span class=3D"Apple-tab-=
span" style=3D"white-space:pre">					</span>}</div><div><span cla=
ss=3D"Apple-tab-span" style=3D"white-space:pre">					</span>conne=
ct_timeout 3</div><div><span class=3D"Apple-tab-span" style=3D"wh=
ite-space:pre">					</span>nb_get_retry 3</div><div><span class=3D=
"Apple-tab-span" style=3D"white-space:pre">					</span>delay_befo=
re_retry 3</div><div><span class=3D"Apple-tab-span" style=3D"whit=
e-space:pre">				</span>}</div><div><span class=3D"Apple-tab-span=
" style=3D"white-space:pre">			</span>}</div><div><span class=3D"=
Apple-tab-span" style=3D"white-space:pre">		</span>}</div><div><b=
r></div><div><br></div><div>=C8=E7=B9=FB=D2=AA=CA=B9=D3=C3TCP_CHE=
CK=BC=EC=B2=E2=B8=F7realserver=B5=C4=BD=A1=BF=B5=D7=B4=CC=AC=A3=AC=
=C4=C7=C3=B4=A3=AC=C9=CF=C3=E6=B9=D8=D3=DArealserver=B2=BF=B7=D6=B5=
=C4=B6=A8=D2=E5=D2=B2=BF=C9=D2=D4=CC=E6=BB=BB=CE=AA=C8=E7=CF=C2=C4=
=DA=C8=DD=A3=BA</div><div><span class=3D"Apple-tab-span" style=3D=
"white-space:pre">		</span>=BD=A1=BF=B5=BC=E0=B2=E2<span class=3D=
"Apple-tab-span" style=3D"white-space:pre">		</span></div><div><s=
pan class=3D"Apple-tab-span" style=3D"white-space:pre">		</span>H=
TTP_GET|SSL_GET</div><div><span class=3D"Apple-tab-span" style=3D=
"white-space:pre">			</span>url{} &nbsp; &nbsp;#TCP_GET=B2=BB=C4=DC=
=CA=B9=D3=C3url{},</div><div><span class=3D"Apple-tab-span" style=
=3D"white-space:pre">				</span>path STRING #=C2=B7=BE=B6</div><d=
iv><span class=3D"Apple-tab-span" style=3D"white-space:pre">				<=
/span>digest STRING #digest=C3=FC=C1=EE=D7=F6=B6=D4=B1=C8</div><d=
iv><span class=3D"Apple-tab-span" style=3D"white-space:pre">				<=
/span>status code &nbsp; #=B7=B5=BB=D8=B5=C4http=D7=B4=CC=AC=C2=F0=
</div><div><span class=3D"Apple-tab-span" style=3D"white-space:pr=
e">			</span>connect_port PORT &nbsp;#=B6=CB=BF=DA=BC=EC=B2=E2</d=
iv><div><span class=3D"Apple-tab-span" style=3D"white-space:pre">=
			</span>bindto IPADDR &nbsp; &nbsp; &nbsp;#=BC=EC=B2=E2=B5=C4IP=
</div><div><span class=3D"Apple-tab-span" style=3D"white-space:pr=
e">			</span>connect_timeout INT &nbsp; #=B3=AC=CA=B1=CA=B1=BC=E4=
</div><div><span class=3D"Apple-tab-span" style=3D"white-space:pr=
e">			</span>nb_get_retry INT<span class=3D"Apple-tab-span" style=
=3D"white-space:pre">	</span> &nbsp;#=D6=D8=CA=D4=B4=CE=CA=FD</di=
v><div><span class=3D"Apple-tab-span" style=3D"white-space:pre">=09=
		</span>delay_before_retry INT &nbsp;#=D6=D8=CA=D4=B5=C8=B4=FD=CA=
=B1=BC=E4</div><div><span class=3D"Apple-tab-span" style=3D"white=
-space:pre">	</span></div><div>#############<span class=3D"Apple-=
tab-span" style=3D"white-space:pre">	</span></div><div><span clas=
s=3D"Apple-tab-span" style=3D"white-space:pre">		</span>virtual_s=
erver 172.16.100.1 80 {</div><div><span class=3D"Apple-tab-span"=20=
style=3D"white-space:pre">			</span>delay_loop 6</div><div><span=20=
class=3D"Apple-tab-span" style=3D"white-space:pre">			</span>lb_a=
lgo rr&nbsp;</div><div><span class=3D"Apple-tab-span" style=3D"wh=
ite-space:pre">			</span>lb_kind DR</div><div><span class=3D"Appl=
e-tab-span" style=3D"white-space:pre">			</span>persistence_timeo=
ut 300</div><div><span class=3D"Apple-tab-span" style=3D"white-sp=
ace:pre">			</span>protocol TCP</div><div><br></div><div><span cl=
ass=3D"Apple-tab-span" style=3D"white-space:pre">			</span>sorry_=
server 127.0.0.1 80</div><div><br></div><div><span class=3D"Apple=
-tab-span" style=3D"white-space:pre">			</span>real_server 172.16=
.100.11 80 {</div><div><span class=3D"Apple-tab-span" style=3D"wh=
ite-space:pre">				</span>weight 1</div><div><span class=3D"Apple=
-tab-span" style=3D"white-space:pre">				</span>TCP_CHECK {</div>=
<div><span class=3D"Apple-tab-span" style=3D"white-space:pre">		=09=
		</span>tcp_port 80</div><div><span class=3D"Apple-tab-span" sty=
le=3D"white-space:pre">					</span>connect_timeout 3</div><div><s=
pan class=3D"Apple-tab-span" style=3D"white-space:pre">				</span=
>}</div><div><span class=3D"Apple-tab-span" style=3D"white-space:=
pre">			</span>}</div><div><br></div><div><span class=3D"Apple-ta=
b-span" style=3D"white-space:pre">			</span>real_server 172.16.10=
0.12 80 {</div><div><span class=3D"Apple-tab-span" style=3D"white=
-space:pre">				</span>weight 1</div><div><span class=3D"Apple-ta=
b-span" style=3D"white-space:pre">				</span>TCP_CHECK {</div><di=
v><span class=3D"Apple-tab-span" style=3D"white-space:pre">					<=
/span>connect_port 80</div><div><span class=3D"Apple-tab-span" st=
yle=3D"white-space:pre">					</span>connect_timeout 3</div><div><=
span class=3D"Apple-tab-span" style=3D"white-space:pre">				</spa=
n> &nbsp;}</div><div><span class=3D"Apple-tab-span" style=3D"whit=
e-space:pre">			</span>}</div><div><span class=3D"Apple-tab-span"=
 style=3D"white-space:pre">		</span>}</div><div><br></div><div>=CB=
=B5=C3=F7=A3=BA=C6=E4=D6=D0=B5=C4sorry_server=CA=C7=D3=C3=D3=DA=B6=
=A8=D2=E5=CB=F9=D3=D0realserver=BE=F9=B3=F6=CF=D6=B9=CA=D5=CF=CA=B1=
=CB=F9=D3=C3=B5=C4=B7=FE=CE=F1=C6=F7=A1=A3</div><div><br></div><d=
iv><br></div><div><br></div><div><br></div><div><br></div><div><b=
r></div><div><br></div><div><br></div><div><br></div><div><br></d=
iv><div>keepalived=CD=A8=D6=AA=BD=C5=B1=BE=BD=F8=BD=D7=CA=BE=C0=FD=
=A3=BA</div><div><br></div><div>=CF=C2=C3=E6=B5=C4=BD=C5=B1=BE=BF=
=C9=D2=D4=BD=D3=CA=DC=D1=A1=CF=EE=A3=AC=C6=E4=D6=D0=A3=BA</div><d=
iv>-s, --service SERVICE,...=A3=BA=D6=B8=B6=A8=B7=FE=CE=F1=BD=C5=B1=
=BE=C3=FB=B3=C6=A3=AC=B5=B1=D7=B4=CC=AC=C7=D0=BB=BB=CA=B1=BF=C9=D7=
=D4=B6=AF=C6=F4=B6=AF=A1=A2=D6=D8=C6=F4=BB=F2=B9=D8=B1=D5=B4=CB=B7=
=FE=CE=F1=A3=BB</div><div>-a, --address VIP: =D6=B8=B6=A8=CF=E0=B9=
=D8=D0=E9=C4=E2=C2=B7=D3=C9=C6=F7=B5=C4VIP=B5=D8=D6=B7=A3=BB</div=
><div>-m, --mode {mm|mb}=A3=BA=D6=B8=B6=A8=D0=E9=C4=E2=C2=B7=D3=C9=
=B5=C4=C4=A3=D0=CD=A3=ACmm=B1=ED=CA=BE=D6=F7=D6=F7=A3=ACmb=B1=ED=CA=
=BE=D6=F7=B1=B8=A3=BB=CB=FC=C3=C7=B1=ED=CA=BE=CF=E0=B6=D4=D3=DA=CD=
=AC=D2=BB=D6=D6=B7=FE=CE=F1=B6=F8=B7=BD=A3=AC=C6=E4VIP=B5=C4=B9=A4=
=D7=F7=C0=E0=D0=CD=A3=BB</div><div>-n, --notify {master|backup|fa=
ult}=A3=BA=D6=B8=B6=A8=CD=A8=D6=AA=B5=C4=C0=E0=D0=CD=A3=AC=BC=B4v=
rrp=BD=C7=C9=AB=C7=D0=BB=BB=B5=C4=C4=BF=B1=EA=BD=C7=C9=AB=A3=BB</=
div><div>-h, --help=A3=BA=BB=F1=C8=A1=BD=C5=B1=BE=B5=C4=CA=B9=D3=C3=
=B0=EF=D6=FA=A3=BB</div><div><br></div><div><span class=3D"Apple-=
tab-span" style=3D"white-space:pre">		</span>#!/bin/bash</div><di=
v><span class=3D"Apple-tab-span" style=3D"white-space:pre">		</sp=
an># Author: MageEdu &lt;linuxedu@foxmail.com&gt;</div><div><span=
 class=3D"Apple-tab-span" style=3D"white-space:pre">		</span># de=
scription: An example of notify script</div><div><span class=3D"A=
pple-tab-span" style=3D"white-space:pre">		</span># Usage: notify=
.sh -m|--mode {mm|mb} -s|--service SERVICE1,... -a|--address VIP=20=
&nbsp;-n|--notify {master|backup|falut} -h|--help&nbsp;</div><div=
><br></div><div><span class=3D"Apple-tab-span" style=3D"white-spa=
ce:pre">		</span>#contact=3D'linuxedu@foxmail.com'</div><div><spa=
n class=3D"Apple-tab-span" style=3D"white-space:pre">		</span>hel=
pflag=3D0</div><div><span class=3D"Apple-tab-span" style=3D"white=
-space:pre">		</span>serviceflag=3D0</div><div><span class=3D"App=
le-tab-span" style=3D"white-space:pre">		</span>modeflag=3D0</div=
><div><span class=3D"Apple-tab-span" style=3D"white-space:pre">	=09=
</span>addressflag=3D0</div><div><span class=3D"Apple-tab-span" s=
tyle=3D"white-space:pre">		</span>notifyflag=3D0</div><div><br></=
div><div><span class=3D"Apple-tab-span" style=3D"white-space:pre"=
>		</span>contact=3D'root@localhost'</div><div><br></div><div><sp=
an class=3D"Apple-tab-span" style=3D"white-space:pre">		</span>Us=
age() {</div><div><span class=3D"Apple-tab-span" style=3D"white-s=
pace:pre">		</span> &nbsp;echo "Usage: notify.sh [-m|--mode {mm|m=
b}] [-s|--service SERVICE1,...] &lt;-a|--address VIP&gt; &nbsp;&l=
t;-n|--notify {master|backup|falut}&gt;"&nbsp;</div><div><span cl=
ass=3D"Apple-tab-span" style=3D"white-space:pre">		</span> &nbsp;=
echo "Usage: notify.sh -h|--help"</div><div><span class=3D"Apple-=
tab-span" style=3D"white-space:pre">		</span>}</div><div><br></di=
v><div><span class=3D"Apple-tab-span" style=3D"white-space:pre">=09=
	</span>ParseOptions() {</div><div><span class=3D"Apple-tab-span"=
 style=3D"white-space:pre">		</span> &nbsp;local I=3D1;</div><div=
><span class=3D"Apple-tab-span" style=3D"white-space:pre">		</spa=
n> &nbsp;if [ $# -gt 0 ]; then</div><div><span class=3D"Apple-tab=
-span" style=3D"white-space:pre">			</span>while [ $I -le $# ]; d=
o</div><div><span class=3D"Apple-tab-span" style=3D"white-space:p=
re">			</span> &nbsp;case $1 in</div><div><span class=3D"Apple-ta=
b-span" style=3D"white-space:pre">			</span> &nbsp;-s|--service)<=
/div><div><span class=3D"Apple-tab-span" style=3D"white-space:pre=
">				</span>[ $# -lt 2 ] &amp;&amp; return 3</div><div><span cla=
ss=3D"Apple-tab-span" style=3D"white-space:pre">				</span>servic=
eflag=3D1</div><div><span class=3D"Apple-tab-span" style=3D"white=
-space:pre">				</span>services=3D(`echo $2|awk -F"," '{for(i=3D1=
;i&lt;=3DNF;i++) print $i}'`)</div><div><span class=3D"Apple-tab-=
span" style=3D"white-space:pre">				</span>shift 2 ;;</div><div><=
span class=3D"Apple-tab-span" style=3D"white-space:pre">			</span=
> &nbsp;-h|--help)</div><div><span class=3D"Apple-tab-span" style=
=3D"white-space:pre">				</span>helpflag=3D1</div><div><span clas=
s=3D"Apple-tab-span" style=3D"white-space:pre">				</span>return=20=
0</div><div><span class=3D"Apple-tab-span" style=3D"white-space:p=
re">				</span>shift</div><div><span class=3D"Apple-tab-span" sty=
le=3D"white-space:pre">				</span>;;</div><div><span class=3D"App=
le-tab-span" style=3D"white-space:pre">			</span> &nbsp;-a|--addr=
ess)</div><div><span class=3D"Apple-tab-span" style=3D"white-spac=
e:pre">				</span>[ $# -lt 2 ] &amp;&amp; return 3</div><div><spa=
n class=3D"Apple-tab-span" style=3D"white-space:pre">				</span>a=
ddressflag=3D1</div><div><span class=3D"Apple-tab-span" style=3D"=
white-space:pre">				</span>vip=3D$2</div><div><span class=3D"App=
le-tab-span" style=3D"white-space:pre">				</span>shift 2</div><d=
iv><span class=3D"Apple-tab-span" style=3D"white-space:pre">				<=
/span>;;</div><div><span class=3D"Apple-tab-span" style=3D"white-=
space:pre">			</span> &nbsp;-m|--mode)</div><div><span class=3D"A=
pple-tab-span" style=3D"white-space:pre">				</span>[ $# -lt 2 ]=20=
&amp;&amp; return 3</div><div><span class=3D"Apple-tab-span" styl=
e=3D"white-space:pre">				</span>mode=3D$2</div><div><span class=3D=
"Apple-tab-span" style=3D"white-space:pre">				</span>shift 2</di=
v><div><span class=3D"Apple-tab-span" style=3D"white-space:pre">=09=
			</span>;;</div><div><span class=3D"Apple-tab-span" style=3D"wh=
ite-space:pre">			</span> &nbsp;-n|--notify)</div><div><span clas=
s=3D"Apple-tab-span" style=3D"white-space:pre">				</span>[ $# -l=
t 2 ] &amp;&amp; return 3</div><div><span class=3D"Apple-tab-span=
" style=3D"white-space:pre">				</span>notifyflag=3D1</div><div><=
span class=3D"Apple-tab-span" style=3D"white-space:pre">				</spa=
n>notify=3D$2</div><div><span class=3D"Apple-tab-span" style=3D"w=
hite-space:pre">				</span>shift 2</div><div><span class=3D"Apple=
-tab-span" style=3D"white-space:pre">				</span>;;</div><div><spa=
n class=3D"Apple-tab-span" style=3D"white-space:pre">			</span> &=
nbsp;*)</div><div><span class=3D"Apple-tab-span" style=3D"white-s=
pace:pre">				</span>echo "Wrong options..."</div><div><span clas=
s=3D"Apple-tab-span" style=3D"white-space:pre">				</span>Usage</=
div><div><span class=3D"Apple-tab-span" style=3D"white-space:pre"=
>				</span>return 7</div><div><span class=3D"Apple-tab-span" sty=
le=3D"white-space:pre">				</span>;;</div><div><span class=3D"App=
le-tab-span" style=3D"white-space:pre">			</span> &nbsp; esac</di=
v><div><span class=3D"Apple-tab-span" style=3D"white-space:pre">=09=
		</span>done</div><div><span class=3D"Apple-tab-span" style=3D"w=
hite-space:pre">			</span>return 0</div><div><span class=3D"Apple=
-tab-span" style=3D"white-space:pre">		</span> &nbsp;fi</div><div=
><span class=3D"Apple-tab-span" style=3D"white-space:pre">		</spa=
n>}</div><div><br></div><div><span class=3D"Apple-tab-span" style=
=3D"white-space:pre">		</span>#workspace=3D$(dirname $0)</div><di=
v><br></div><div><span class=3D"Apple-tab-span" style=3D"white-sp=
ace:pre">		</span>RestartService() {</div><div><span class=3D"App=
le-tab-span" style=3D"white-space:pre">		</span> &nbsp;if [ ${#@}=
 -gt 0 ]; then</div><div><span class=3D"Apple-tab-span" style=3D"=
white-space:pre">			</span>for I in $@; do</div><div><span class=3D=
"Apple-tab-span" style=3D"white-space:pre">			</span> &nbsp;if [=20=
-x /etc/rc.d/init.d/$I ]; then</div><div><span class=3D"Apple-tab=
-span" style=3D"white-space:pre">				</span>/etc/rc.d/init.d/$I r=
estart</div><div><span class=3D"Apple-tab-span" style=3D"white-sp=
ace:pre">			</span> &nbsp;else</div><div><span class=3D"Apple-tab=
-span" style=3D"white-space:pre">				</span>echo "$I is not a val=
id service..."</div><div><span class=3D"Apple-tab-span" style=3D"=
white-space:pre">			</span> &nbsp;fi</div><div><span class=3D"App=
le-tab-span" style=3D"white-space:pre">			</span>done</div><div><=
span class=3D"Apple-tab-span" style=3D"white-space:pre">		</span>=
 &nbsp;fi</div><div><span class=3D"Apple-tab-span" style=3D"white=
-space:pre">		</span>}</div><div><br></div><div><span class=3D"Ap=
ple-tab-span" style=3D"white-space:pre">		</span>StopService() {<=
/div><div><span class=3D"Apple-tab-span" style=3D"white-space:pre=
">		</span> &nbsp;if [ ${#@} -gt 0 ]; then</div><div><span class=3D=
"Apple-tab-span" style=3D"white-space:pre">			</span>for I in $@;=
 do</div><div><span class=3D"Apple-tab-span" style=3D"white-space=
:pre">			</span> &nbsp;if [ -x /etc/rc.d/init.d/$I ]; then</div><=
div><span class=3D"Apple-tab-span" style=3D"white-space:pre">			=09=
</span>/etc/rc.d/init.d/$I stop</div><div><span class=3D"Apple-ta=
b-span" style=3D"white-space:pre">			</span> &nbsp;else</div><div=
><span class=3D"Apple-tab-span" style=3D"white-space:pre">				</s=
pan>echo "$I is not a valid service..."</div><div><span class=3D"=
Apple-tab-span" style=3D"white-space:pre">			</span> &nbsp;fi</di=
v><div><span class=3D"Apple-tab-span" style=3D"white-space:pre">=09=
		</span>done</div><div><span class=3D"Apple-tab-span" style=3D"w=
hite-space:pre">		</span> &nbsp;fi</div><div><span class=3D"Apple=
-tab-span" style=3D"white-space:pre">		</span>}</div><div><br></d=
iv><div><br></div><div><span class=3D"Apple-tab-span" style=3D"wh=
ite-space:pre">		</span>Notify() {</div><div><span class=3D"Apple=
-tab-span" style=3D"white-space:pre">			</span>mailsubject=3D"`ho=
stname` to be $1: $vip floating"</div><div><span class=3D"Apple-t=
ab-span" style=3D"white-space:pre">			</span>mailbody=3D"`date '+=
%F %H:%M:%S'`, vrrp transition, `hostname` changed to be $1."</di=
v><div><span class=3D"Apple-tab-span" style=3D"white-space:pre">=09=
		</span>echo $mailbody | mail -s "$mailsubject" $contact</div><d=
iv><span class=3D"Apple-tab-span" style=3D"white-space:pre">		</s=
pan>}</div><div><br></div><div><br></div><div><span class=3D"Appl=
e-tab-span" style=3D"white-space:pre">		</span># Main Function</d=
iv><div><span class=3D"Apple-tab-span" style=3D"white-space:pre">=
		</span>ParseOptions $@</div><div><span class=3D"Apple-tab-span"=
 style=3D"white-space:pre">		</span>[ $? -ne 0 ] &amp;&amp; Usage=
 &amp;&amp; exit 5</div><div><br></div><div><span class=3D"Apple-=
tab-span" style=3D"white-space:pre">		</span>[ $helpflag -eq 1 ]=20=
&amp;&amp; Usage &amp;&amp; exit 0</div><div><br></div><div><span=
 class=3D"Apple-tab-span" style=3D"white-space:pre">		</span>if [=
 $addressflag -ne 1 -o $notifyflag -ne 1 ]; then</div><div><span=20=
class=3D"Apple-tab-span" style=3D"white-space:pre">		</span> &nbs=
p;Usage</div><div><span class=3D"Apple-tab-span" style=3D"white-s=
pace:pre">		</span> &nbsp;exit 2</div><div><span class=3D"Apple-t=
ab-span" style=3D"white-space:pre">		</span>fi</div><div><br></di=
v><div><span class=3D"Apple-tab-span" style=3D"white-space:pre">=09=
	</span>mode=3D${mode:-mb}</div><div><br></div><div><span class=3D=
"Apple-tab-span" style=3D"white-space:pre">		</span>case $notify=20=
in</div><div><span class=3D"Apple-tab-span" style=3D"white-space:=
pre">		</span>'master')</div><div><span class=3D"Apple-tab-span"=20=
style=3D"white-space:pre">		</span> &nbsp;if [ $serviceflag -eq 1=
 ]; then</div><div><span class=3D"Apple-tab-span" style=3D"white-=
space:pre">			</span> &nbsp;RestartService ${services[*]}</div><d=
iv><span class=3D"Apple-tab-span" style=3D"white-space:pre">		</s=
pan> &nbsp;fi</div><div><span class=3D"Apple-tab-span" style=3D"w=
hite-space:pre">		</span> &nbsp;Notify master</div><div><span cla=
ss=3D"Apple-tab-span" style=3D"white-space:pre">		</span> &nbsp;;=
;</div><div><span class=3D"Apple-tab-span" style=3D"white-space:p=
re">		</span>'backup')</div><div><span class=3D"Apple-tab-span" s=
tyle=3D"white-space:pre">		</span> &nbsp;if [ $serviceflag -eq 1=20=
]; then</div><div><span class=3D"Apple-tab-span" style=3D"white-s=
pace:pre">			</span>if [ "$mode" =3D=3D 'mb' ]; then</div><div><s=
pan class=3D"Apple-tab-span" style=3D"white-space:pre">			</span>=
 &nbsp;StopService ${services[*]}</div><div><span class=3D"Apple-=
tab-span" style=3D"white-space:pre">			</span>else</div><div><spa=
n class=3D"Apple-tab-span" style=3D"white-space:pre">			</span> &=
nbsp;RestartService ${services[*]}</div><div><span class=3D"Apple=
-tab-span" style=3D"white-space:pre">			</span>fi</div><div><span=
 class=3D"Apple-tab-span" style=3D"white-space:pre">		</span> &nb=
sp;fi</div><div><span class=3D"Apple-tab-span" style=3D"white-spa=
ce:pre">		</span> &nbsp;Notify backup</div><div><span class=3D"Ap=
ple-tab-span" style=3D"white-space:pre">		</span> &nbsp;;;</div><=
div><span class=3D"Apple-tab-span" style=3D"white-space:pre">		</=
span>'fault')</div><div><span class=3D"Apple-tab-span" style=3D"w=
hite-space:pre">		</span> &nbsp;Notify fault</div><div><span clas=
s=3D"Apple-tab-span" style=3D"white-space:pre">		</span> &nbsp;;;=
</div><div><span class=3D"Apple-tab-span" style=3D"white-space:pr=
e">		</span>*)</div><div><span class=3D"Apple-tab-span" style=3D"=
white-space:pre">		</span> &nbsp;Usage</div><div><span class=3D"A=
pple-tab-span" style=3D"white-space:pre">		</span> &nbsp;exit 4</=
div><div><span class=3D"Apple-tab-span" style=3D"white-space:pre"=
>		</span> &nbsp;;;</div><div><span class=3D"Apple-tab-span" styl=
e=3D"white-space:pre">		</span>esac</div><div><br></div><div><br>=
</div><div><br></div><div>=D4=DAkeepalived.conf=C5=E4=D6=C3=CE=C4=
=BC=FE=D6=D0=A3=AC=C6=E4=B5=F7=D3=C3=B7=BD=B7=A8=C8=E7=CF=C2=CB=F9=
=CA=BE=A3=BA</div><div>&nbsp; &nbsp; notify_master "/etc/keepaliv=
ed/notify.sh -n master -a 172.16.100.1" &nbsp;</div><div>&nbsp; &=
nbsp; notify_backup "/etc/keepalived/notify.sh -n backup -a 172.1=
6.100.1" &nbsp;</div><div>&nbsp; &nbsp; notify_fault "/etc/keepal=
ived/notify.sh -n fault -a 172.16.100.1" &nbsp;</div><div><br></d=
iv><div><br></div><div><br></div><div><br></div><div><br></div><d=
iv><br></div><div><br></div><div><br></div><div><br></div><div><b=
r></div><div><br></div></body></html>

------=_Next_Part_0004308950.961--

------=_Next_Part_0012926850.827--

